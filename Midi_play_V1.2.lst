            ;****************************************************************************
            ;           TRD16IDE Midi (PCM12) Demo Code , TRITAN Technology Inc.
            ;                     
            ;****************************************************************************
            ;
            
            ;=========================Include By <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\Midi_Play_v1.2.INC>=========================
            /* ================================================================= */	
            ;===== Melody.inc is Added by TT65DevIDE at Tue Sep 30 14:48:29 2008 =====
            /* ================================================================= */	
            
            
            // =====================
            //      COMMON I/O      
            // =====================
            
            STATUS       EQU    00H       ;R/W, BIT0: Zero.
                                          ;R/W, BIT1: Carry.
                                          ;R/W, BIT2: Overflow.
                                          ;R/W, BIT3: Negative.
                                          ;R/W, BIT7: Global Interrupt Enable.
                                          ;R/W, BIT[12:8]: SD_EN,NH_EN,TFT_EN,TMSEN,SPI_EN.
                                          ;R/W, BIT13: Interrupt Vector Table Access Enable.
                                          ;R/W, BIT14: Filter Buffer Available.
                                          ;R/W, BIT15: Parser Buffer Available.
            INTENA       EQU    01H       ;R/W, Int Enable.
            INTREQ       EQU    02H       ;R/W, Int Request.
            IntVect      EQU    03H       ;R/W, Interrupt Table
            IOC_PA       EQU    04H       ;R/W, PortA IO control. ('0' = input,'1' = output)
            IOC_PB       EQU    05H       ;R/W, PortB IO control. ('0' = input,'1' = output)
            IOC_PC       EQU    06H       ;R/W, PortC IO control. ('0' = input,'1' = output)
            IOC_PD       EQU    0CH       ;R/W, PortD IO control. ('0' = input,'1' = output)
            PortA        EQU    07H       ;R/W, General input/output port.
            PortB        EQU    08H       ;R/W, General input/output port.
            PortC        EQU    09H       ;R/W, General input/output port.
            PortD        EQU    0AH       ;R/W, General output port.
            SPH_CTL      EQU    0BH       ;W,   Specical Peripheral control register.
            SPI_CTL      EQU    0DH       ;R/W, Serial interface control register.
            SPI_DAT      EQU    0EH       ;R/W, Serial interface data.
            SD_CTL       EQU    0FH       ;R/W, SD card interface control register.
            SD_DAT       EQU    10H       ;R/W, SD card interface data.
            SD_RSP       EQU    11H       ;R/W, SD card interface response register.
            DACL         EQU    16H       ;W, DAC output L Channel.
            DACR         EQU    17H       ;W, DAC output R Channel.
            ClrWDT       EQU    1DH       ;W, Clear Watch-dog reset.
            Real_T       EQU    1DH       ;R, System Real-Time Counter, base on 31.25us
            IOP_IX       EQU    1EH       ;W, Programming IO Port index .
            IOP_DAT      EQU    1FH       ;W, Programming IO Port Data .
            
            // ********************************************************************	
            VarRM[0:127]={
            	RAM0,RAM1
            	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            	myscankeycnt,
            	myscankeybuff[16],
            	mycheckkeycnt,
            	mycheckkeybuff[16],
            	mykeycntEn,
            	mykeycnt,
            	;;mykeyvalue[3],
            	mykeyoldvalue,
            	count_num,
            	Mode_flag,
            	loop_play_addr,    ;;play table start addr
            	loop_play_length,  ;;0-play all loop >0 
            	loop_play_flag,    ;;0x0ffff-enable loop play 0-disable
            	loop_play_num,     ;; current play num
            	timer_05ms,
            	game1count,
            	game2count,
            	game3count,
            	okcount,
            	ngcount,
            	timcount,
            	gmode_state,
            	answer_disable,
            	waitflag,
            	key_debounce,
            	one_flag,
            	wait_count,
            	wait_en,
            	repeat_flag,
            	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            	counthalt
            	Haltflag
            	
            	
            	_31us
            	_last31us
            	TOTALKEY	
            	
            	
            	MidiPcmIn
            	MidiPcmOut
            	_MIDIFLAG	// 
            	// B3 :lauch midi after play voice			midi请求播放的标志
            	PlayFlag
            	Midi_bank0[41]
            ;/////////---------------
            PCMIN_PTR, PCMOU_PTR
            FrameSample1
            ZeroFrame_s
            read_flag
            ADPCM_Data1
            
            
            
            ;////////////////
            };
            // ********************************************************************	
            VarRM[128:511]={
            BaseOn128#StackBuf[32]
            Baseon32#Midi_bank1[208]
            Midi_bank1_1[8]
            AdpcmFiltBuf[90]
            };
            // ********************************************************************	
            #define 	Optimal_RM 
            VarRM[512:4095]={
            Baseon256#Midi_bank2[1000]	
            Baseon512#MidiPCMBuf[512]
            
            //-------- for scan key
            scnkeyvuff[4]
            keypressbuff[16]
            //-------- for scan key
            
            
            
            };
            
            // ********************************************************************	
            ShareVar={
            
            };
            
            External Label {              
            //_0_
            };
            
            ;=========================Include <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\Midi_Play_v1.2.INC> END=========================
            
             
            #define	speed	0x00
            #define   SPI_Speed 0x00
            //#define TRD16P201A_SPI
            #define SPI_TYPE1
            ;#define   SPI_TYPE2
            #define   RamEndAddr 0x07ff
            #define   keyboardsongnumber 0
            #define   GetVoiceKeyNOVolData  0x7f    
            #define   MAX_Midi_Volume 0x00ff
            #define Spi_Offset_High_WORD 0x00
            #define Spi_Offset_High_byte 0x00
            #define Spi_Offset_Low_WORD  0x00 
            #define Pitch_wheel_Beat 0x20
            
            
                ORG     0000H
            RSTB_ENTRY:
0000:           PCH=  SYS_PROG_ENTRY
            
0001:           LJMP  SYS_PROG_ENTRY
                ;;------------------------
                ORG     0004H
                ;;------------------------
            WAKEUP_ENTRY:
0004:           PCH=  WAKEUP_PROC
0005:           LJMP  WAKEUP_PROC
                ;;------------------------
                ORG     0020H
            // ********************************************************************
            WAKEUP_PROC:
0020:           ar    = 3
0021:           io[intena]  =ar
                
0022:           IO[CLRWDT]  = AR
                
0023:           pch = SPI_Initial
0024:       		lcall SPI_Initial 
            	
0025:           pch	= Rel_powerdown_cmd
0026:       		lcall	Rel_powerdown_cmd
0027:       		pch	= wait_flash_ready
0028:       		lcall	wait_flash_ready
            	
0029:       		pch = keyscanini
002A:           lcall keyscanini
                
002B:           ar = 0
002C:       		rm[Mode_flag] = ar
                
                // Circular bufer setup
002D:           i0    = MidiPCMBuf
002F:           rm[MidiPcmIn] = i0;
0030:           rm[MidiPcmOut] = i0;
            
                // Length = 256
                //ar    = 8   // 2^8=256 ==> CBL
0031:           ar    = 9   // 2^9=512 ==> CBL
0032:           CBL   = ar
                
0033:           jmp StartMainLoop
                
                
0034:           cx    = RamEndAddr;
0036:           cx--
0037:           cx--
0038:           ar    = 0;
0039:           i1    = 2
            Power_on_init_clr_SRAM2:
003A:           rm[i1++]  = ar;
003B:           loop    Power_on_init_clr_SRAM2
                
003C:           jmp main_loop
                
            clrcountmain_loo2:
003D:           ar    =rm[Haltflag]
003E:           clr   ar.b2
003F:           rm[Haltflag] =ar
0040:           ar    =0
0041:           rm[counthalt] =ar
0042:           jmp   main_loo2
            /* ================================================================= */
            // ------------- Main Program Start --------------------------------
            /* ================================================================= */
            SYS_PROG_ENTRY:
0043:           call    Power_on_init
                
                
            PAGE1ENTRY:
            		
            		;-------------
0044:           IO[CLRWDT]  = AR
                ;----------
                
0045:           ar = 0xFFFF
0047:       		rm[adp_vol] = ar    ;adpcm音量控制 (对所有adpcm 通道起作用)
0048:       		ar		= 0x1FFF ;当前通道下 adpcm-采样设定 
004A:       		rm[AdpcmSample]  = ar
            
004B:       		clr IO[PortA].b4                                    
004C:       		clr IO[PortA].b5                                    
004D:       		clr IO[PortA].b6                                    
004E:       		clr IO[PortA].b7                                    
004F:       		clr IO[PortB].b0                                    
0050:       		clr IO[PortB].b1                                    
0051:       		clr IO[PortB].b2                                    
0052:       		clr IO[PortB].b3                                    
0053:       		clr IO[PortB].b4
            			
0054:       		test io[PortB].b7
0055:       		jzr  Melody
0056:       		ar = 0
0057:       		rm[timer_05ms] = ar
0058:       		ENI
                //ENA     INT0
                //ENA     INT1
0059:           ENA     INT2 
005A:           ar = 1
005B:           rm[waitflag] = ar
005C:           ax = 0x4e20
            wait10s:
            		;;;;;;;;;;;;;;;;;;;;;;;
005E:       		IO[CLRWDT]  = AR
            		;;;;;;;;;;;;;;;;;;;;;;;
005F:           ar = rm[timer_05ms]
0060:           sf = ar - ax
0061:           jnz wait10s
                
0062:           ar = io[PortC]
0063:           ar &= 0x7f
             
0064:           jnz StartMainLoop
            
0065:           ar = 5
0066:           rm[Mode_flag] = ar
0067:           pch = SleepM
0068:           ljmp SleepM
            		
            Melody:
0069:       		ar = 0
            		
006A:       		clr IO[PortA].b4                                    
006B:       		clr IO[PortA].b5                                    
006C:       		clr IO[PortA].b6                                    
006D:       		clr IO[PortA].b7                                    
006E:       		clr IO[PortB].b0                                    
006F:       		clr IO[PortB].b1                                    
0070:       		clr IO[PortB].b2                                    
0071:       		clr IO[PortB].b3                                    
0072:       		clr IO[PortB].b4
            		
0073:       		set IO[PortB].b2
0074:       		test IO[PortC].b4
0075:       		jzr  N00
            		
0076:       		ar = 5
0077:       		rm[Mode_flag] = ar
            		
0078:       		pch = SleepM
0079:           ljmp SleepM
                
            N00:
007A:       		set IO[PortB].b2
007B:       		test IO[PortC].b4
007C:       		jzr N1
            		
007D:           ar = 5
007E:       		rm[Mode_flag] = ar
007F:       		pch = SleepM
0080:           ljmp SleepM
            N1:
0081:       		clr IO[PortB].b2
0082:       		set IO[PortA].b4
0083:       		test IO[PortC].b1
0084:       		jzr  N2
            		
0085:       		ar = 5
0086:       		rm[Mode_flag] = ar
0087:       		pch = SleepM
0088:           ljmp SleepM
            N2:    
0089:       		clr IO[PortA].b4
008A:       		set IO[PortA].b7
008B:       		test IO[PortC].b0
008C:       		jzr  IfSwitchTestMode
            		
008D:       		ar = 5
008E:       		rm[Mode_flag] = ar
008F:       		pch = SleepM
0090:           ljmp SleepM
                
            IfSwitchTestMode:
0091:       		clr IO[PortA].b4                                    
0092:       		clr IO[PortA].b5                                    
0093:       		clr IO[PortA].b6                                    
0094:       		clr IO[PortA].b7                                    
0095:       		clr IO[PortB].b0                                    
0096:       		clr IO[PortB].b1                                    
0097:       		clr IO[PortB].b2                                    
0098:       		clr IO[PortB].b3                                    
0099:       		clr IO[PortB].b4
009A:       		nop
009B:       		nop
            		
009C:       		set IO[PortB].b1
009D:       		nop
009E:       		nop
009F:       		nop
00A0:       		nop
00A1:       		test IO[PortC].b0
00A2:       		nop
00A3:       		nop
00A4:       		nop
00A5:       		test IO[PortC].b0
00A6:       		jzr StartModeStart
            		
00A7:       		clr IO[PortB].b1 
00A8:       		set IO[PortA].b4
00A9:       		nop
00AA:       		nop
00AB:       		nop
00AC:       		nop
00AD:       		test IO[PortC].b2
00AE:       		nop
00AF:       		nop
00B0:       		nop
00B1:       		test IO[PortC].b2
00B2:       		jzr  StartModeStart
            		
            		
            		
            TestModeStart:
00B3:       		ar = 93
00B4:           rm[adp_unmber] = ar
00B5:           ar = 1 
00B6:           rm[adp_ch_index] = AR 
00B7:           pch   = play_adpcm_inti
00B8:           lcall	play_adpcm_inti
00B9:       		ar = 4
00BA:       		rm[Mode_flag] = ar
            		
00BB:       		ar = 2
00BC:       		rm[waitflag] = ar
            		
00BD:       		pch = StartMainLoop
00BE:       		ljmp StartMainLoop
                
            StartModeStart:
00BF:       		ar = 2
00C0:       		rm[waitflag] = ar
00C1:           ar = 0x0ffff
00C3:           rm[loop_play_flag] = ar
00C4:           p0 = #StartModeOnTable
00C6:           ar = p0
00C7:           rm[loop_play_addr] = ar
00C8:           ar = 3
00C9:           rm[loop_play_length] = ar 
00CA:       		ar = 0
00CB:       		rm[Mode_flag] = ar
            		
00CC:       		ar = 0x03E9
00CE:          	rm[mykeycnt] = ar ;;;;disable key when power on
               	
            StartMainLoop: 
            ;   		ar = 9
            ;    		rm[adp_unmber] = ar 
            ;    		rm[adp_ch_index] = AR 
            ;    		pch   = play_adpcm_inti
            ;    		lcall	play_adpcm_inti
            ;    		ar = 2
            ;    		rm[adp_unmber] = ar 
            ;    		rm[adp_ch_index] = AR 
            ;    		pch   = play_adpcm_inti
            ;    		lcall	play_adpcm_inti
            ;    		ar = 3
            ;    		rm[adp_unmber] = ar 
            ;    		rm[adp_ch_index] = AR 
            ;    		pch   = play_adpcm_inti
            ;    		lcall	play_adpcm_inti
            ;    		ar = 4
            ;    		rm[adp_unmber] = ar 
            ;    		rm[adp_ch_index] = AR 
            ;    		pch   = play_adpcm_inti
            ;    		lcall	play_adpcm_inti
            ;    		ar = 5
            ;    		rm[adp_unmber] = ar 
            ;    		rm[adp_ch_index] = AR 
            ;    		pch   = play_adpcm_inti
            ;    		lcall	play_adpcm_inti
                		
                		;;pch   = PlayNextMidiCommand
                		;;lcall	PlayNextMidiCommand
                		
                		;;ar = 3
            				;;rm[PlayMidi] 	=	ar
            				;;pch =	PlayMidiCommand
            				;;lcall	PlayMidiCommand
            				
00CF:           		ENI
00D0:           		ENA     INT0
00D1:           		ENA     INT1
00D2:           		ENA     INT2
                		
            main_loop:
            		
00D3:       		ar = 0xFFFF
00D5:       		rm[adp_vol] = ar    ;adpcm音量控制 (对所有adpcm 通道起作用)
00D6:       		ar		= 0x1FFF ;当前通道下 adpcm-采样设定 
00D8:       		rm[AdpcmSample]  = ar
            		
00D9:       		ENI
            		;;pch = compPB5
            		;;lcall compPB5
            		
            		;;set io[PortB].b5
            		;;cx = 0x03ff
            ;;loopcc:
            		;;nop
            		;;nop
            		;;loop loopcc
            		
            		;;clr io[PortB].b5
            		
            		;;pch = compPB5
            		;;lcall compPB5
            		
00DA:           ar    =rm[_MIDIFLAG]
00DB:           test    ar.b1
00DC:           jnz     main_loo2
00DD:           test    ar.b15
00DE:           jnz     main_loo2
            
00DF:           ar    = rm[PlayFlag]
00E0:           jnz     main_loo2
00E1:           ar    =io[porta]
00E2:           ar    &=0x1f
00E3:           jnz   clrcountmain_loo2
                
00E4:           ar    =rm[Haltflag]
00E5:           set   ar.b2
00E6:           rm[Haltflag] =ar
00E7:           ar    =rm[counthalt]
00E8:           test    ar.b6
00E9:           jzr   main_loo2
            ;    nop
            ;    dsi	int0
            ;    halt
            ;    nop
                
            main_loo2:
00EA:       		push  p0 
00EB:       		push  i0
00EC:       		push  i1
00ED:           PCH   =even_process
00EE:           Lcall   even_process
00EF:           pop  i1
00F0:       		pop  i0 
00F1:       		pop  p0
            main_loop1:
00F2:           call    WaitPCM_Empty_size
00F3:           if AN jmp   No_EmptyPCM
                
00F4:           ar = rm[Haltflag]
00F5:           test ar.b2
00F6:           jzr main_loop3
00F7:           ar = rm[counthalt]
00F8:           ar++
00F9:           rm[counthalt] =ar
            
            main_loop3:
00FA:           IO[CLRWDT]  = AR
00FB:           PCH = Ch_SampleProcess
00FC:           LCALL Ch_SampleProcess
            
            No_EmptyPCM:
00FD:           	IO[CLRWDT]  = AR
            SleepM:    
00FE:           	ar = rm[Mode_flag]
00FF:       			sf = ar - 5
0100:       			jzr Sleep_Run
0101:       			jmp main_loop
            			
            Sleep_Run:
            
            ;;WaitWavFinish:
            			;;IO[CLRWDT]  = AR
            			;;ar = rm[AdPcmflag]      ;;;;wait wav play finish
                	;;jnz main_loop
                	    	
0102:           	ar = 0
0103:             rm[loop_play_addr] = ar
0104:             rm[loop_play_length] = ar
0105:             rm[loop_play_flag] = ar
0106:             rm[loop_play_num] = ar
0107:             rm[mykeycnt] = ar
                  
0108:           	pch = StopAlllPlaying
0109:       		  lcall StopAlllPlaying
            		  
            
010A:       		  pch = Rampdown_Process
010B:           	lcall Rampdown_Process
                
010C:           	pch = clr_PCMBuf
010D:           	lcall  clr_PCMBuf
                	
                	;;pch = Pwm_Process
                	;;lcall Pwm_Process
            		  
010E:       			ar = rm[PlayFlag]
010F:           	jnz main_loop
                	
0110:           	ar = rm[AdPcmflag]
0111:           	jnz main_loop
                	
                	;;ar = io[PortC]
                	;;ar &= 0x7f
                	;;nop
                	;;nop
                	;;nop
                	;;ar = io[PortC]
                	;;ar &= 0x7f
                	
                	;;jnz main_loop
                
                	;;pch = Rampdown_Process
                	;;lcall Rampdown_Process
                
                	;;pch = clr_PCMBuf
                	;;lcall  clr_PCMBuf
                	
                	;;pch = Pwm_Process
                	;;lcall Pwm_Process
                	
0112:       			pch = Deep_powerdown_cmd
0113:       			lcall	Deep_powerdown_cmd 
            			
            			;;ar = 0
            			;;cx = 0x01ff
            			
            			;;i0 = MidiPCMBuf
            			
            ;;ClrMidiPCMBuf:
            			;;rm[i0++] = ar			
            			;;loop ClrMidiPCMBuf
            			
            			
            			
0114:       			clr		Io[Status].B8 
                	
                	
0115:           	ar = 0x0F
0116:       			io[IOC_PA] = ar
            	
0117:       			ar = 0x09
0118:       			io[PortA]	= ar
            
0119:           	ar = io[IOC_PB]			//pb.7 1khz检测口
011A:           	ax = 0x0000
011B:       			ar = ar & ax
011C:           	io[IOC_PB] = ar
011D:           	ar = io[PortB]
011E:           	ax = 0x0000
011F:           	ar = ar & ax
0120:           	io[PortB]	= ar
                	
0121:       			ar	=	0x00FF
0123:           	io[IOC_PC] = ar
0124:           	ar =	0x00FF
0126:           	io[PortC] = ar
                	
0127:           	pch = F_IOSetDelayTimer
0128:           	lcall F_IOSetDelayTimer
0129:           	pch =	F_IOSetDelayTimer
012A:           	lcall F_IOSetDelayTimer
012B:           	pch = F_IOSetDelayTimer
012C:           	lcall F_IOSetDelayTimer
                		
012D:       			nop
012E:       			dsi
012F:           	dsi	int2
0130:       			DSI	INT1
0131:           	DSI	INT0
0132:       			HALT
            	
0133:       			NOP
0134:       			NOP
0135:       			NOP
0136:       			NOP
0137:       			NOP
0138:           	jmp   main_loop
                
            ;//   |----------|--------------------|---------------------|  size 256
            ;//             PCMIN_PTR  PCMOU_PTR
            ;// return AN=1 is less 64
            WaitPCM_Empty_size:
0139:           ar    = rm[MidiPcmIn]
013A:           ax    = rm[MidiPcmOut]
                // -----------------------------------
013B:           ar    = ax - ar;
013C:           if an jmp   GetPCM_Empty_IN_GT // -
013D:           jmp   GetPCM_Empty_next
            GetPCM_Empty_IN_GT:
                // length = (256 - PCMIN_PTR + PCMOU_PTR)&0x0FF
013E:           ax    = 512;//ax    = 256;
0140:           ar    = ax + ar;
                //ah    = 0;
            GetPCM_Empty_next:
                // Check empty size > 128
                //sf    = ar - 65
0141:           ax    = 0x081 //129
0143:           sf    = ar-ax
0144:           rets
            
            ///////////////////////////////////////////////////////////////////////////////////////////////
            Power_on_init:
                //bp  = StackBottom   // Stack pointer initial at bottom of 128+32
0145:           ar =StackBuf
0147:           bp =31
0148:           bp+=ar
                // Clear All SRAM 4K
0149:           clr     io[STATUS].b8
014A:           cx    = RamEndAddr;
014C:           cx--
014D:           cx--
014E:           ar    = 0;
014F:           i1    = 2
            Power_on_init_clr_SRAM:
0150:           rm[i1++]  = ar;
0151:           loop    Power_on_init_clr_SRAM
            
                // Circular bufer setup
0152:           i0    = MidiPCMBuf
0154:           rm[MidiPcmIn] = i0;
0155:           rm[MidiPcmOut] = i0;
            
                // Length = 256
                //ar    = 8   // 2^8=256 ==> CBL
0156:           ar    = 9   // 2^9=512 ==> CBL
0157:           CBL   = ar
            
0158:           call    init_intVectTable
0159:           PCH   =keyscanini
015A:           lcall  keyscanini
                
                //timer2 , 2kHz	
015B:       		ar		=	0x01
015C:       		io[IOP_IX]	=	ar 
015D:       		ar 		= 	0x3fff
015F:       		io[IOP_DAT]	=	ar 
            		
0160:           ar    = 0
0161:           rm[PlayMidi]  = ar
                
0162:           Pch	=PowerOnmidSet
0163:           Lcall	PowerOnmidSet
                
                
0164:           	pch =SPI_Initial
0165:           	lcall SPI_Initial    
                	
0166:             	Bx	=4  ; 前4个byte为 文件个数
0167:            	Ar	=0
0168:            	pch 	=Send_SPI_address
0169:           	lcall 	Send_SPI_address
016A:           	pch 	= Get_4_BYTE
016B:           	lcall 	Get_4_BYTE
              
016C:          	I1	=Midi_address
016D:          	Rm[I1++]	=io[SPI_DAT]
016E:          	Rm[I1++]	=io[SPI_DAT]
            
            ;	I1	=Midi_address
            ;	Ar	=0
            ;	Rm[I1++]	=Ar
            ;	Rm[I1++]	=Ar
                
016F:           Pch	=MidiInfInital
0170:           Lcall	MidiInfInital
              
              
0171:           AR    =MAX_Midi_Volume
0173:           rm[Midi_Volume] = ar    
                
0174:           rets	
                
            INTVB7_ENTRY:
            INTVB6_ENTRY:
            INTVB5_ENTRY:
            INTVB4_ENTRY:
            INTVB3_ENTRY:
            INTVB2_ENTRY:
                    ;;ar=IO[INTREQ]
                    ;;ar &= 0x03
                    ;;IO[INTREQ]=ar
0175:               CLR IO[INTREQ].B2 ;Clear Int2 Request!!
                    
0176:               ar = rm[timer_05ms]
0177:               ar++
0178:               rm[timer_05ms] = ar 
                    
0179:               ar = rm[wait_en]
017A:               jzr Next_w
                    
017B:               ar = rm[wait_count]
017C:               ar++
017D:               rm[wait_count] = ar
                    
            Next_w:
017E:               ar = rm[waitflag]
017F:               sf = ar - 1
0180:               jzr W10s
                    
0181:               pch = bac
0182:               ljmp bac 
                    
            W10s:
0183:               test io[PortC].b7
0184:               jzr n0
0185:               clr io[PortC].b7
0186:               pch = bac
0187:               ljmp bac
            n0:
0188:       				set io[PortC].b7  
            bac:				       
0189:               reti
            INTVB0_ENTRY:
            
018A:           CLR     IO[INTREQ].B0 ;Clear Int0 Request!!
                
018B:           ar =rm[Mode_flag]
018C:           sf = ar - 5
018D:           jzr MuteAll
018E:           ar = 0
018F:       		jmp Dac_out
            		   
            MuteALl:
0190:       		ar = 0x000f
0191:           io[18] = ar
0192:           ar = 0
0193:           io[DACL] = ar
0194:           io[DACR] = ar
0195:           jmp Int0End
                
            Dac_out:
                
0196:           push  cbl
0197:           push    i0
0198:           i0    = rm[MidiPcmOut];
0199:           ar  =9
019A:           cbl =ar
019B:           ar =0
019C:           io[DACL]  = rm[i0]; // output DAC L
019D:           rm[i0++]=ar
019E:           io[DACL]  = rm[i0]; // output DAC L
019F:           rm[i0++]=ar
01A0:           io[DACL]  = rm[i0]; // output DAC L
01A1:           rm[i0++]=ar
01A2:           io[DACL]  = rm[i0]; // output DAC L
01A3:           rm[i0++]=ar
01A4:           rm[MidiPcmOut] = i0;
01A5:           pop   i0
01A6:           pop CBL
            Int0End:    
01A7:           RETI
            
            
            INTVB1_ENTRY:
01A8:           CLR     IO[INTREQ].B1 ;Clear Int0 Request!!
01A9:           AR    =RM[TEMPOcount]
01AA:           JNZ   _NOTBEATTIME
01AB:           ar    =rm[TEMPOcountbak]
            
01AC:           RM[TEMPOcount]=ar
01AD:           ar    =rm[_MIDIFLAG]
01AE:           set   ar.b4
01AF:           rm[_MIDIFLAG]=ar
            
            
                _NOTBEATTIME:
01B0:           AR    =RM[TEMPOcount]
01B1:           AR--
01B2:           RM[TEMPOcount]=AR
01B3:           RETI
            
            ////////////////////////////////////////////////////////////////////////
            //-------------------------------------------------------------
            //   System call midi event process
            
            SysReliabilityChk:
01B4:         		ar 		= rm[RAM0]
01B5:         		sf		= ar - 0x0007
01B6:         		jnz  		SysReliabilityChk_error 	; wait for watch-dog reset
01B7:         		ar		= rm[RAM1]
01B8:         		sf		= ar - 0x0006
01B9:         		jnz  		SysReliabilityChk_error 	; wait for watch-dog reset
01BA:         		rets
            SysReliabilityChk_error:
01BB:       		Nop
01BC:       		Jmp	  SysReliabilityChk_error
            ;////////////////////////////////////////////////////						
            
            ;=========================Include By <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\system_inti.asm>=========================
            // ***************************************************************************************
            init_intVectTable:
                // eable int-vector table access
01BD:           set   io[STATUS].b13
01BE:           cx    = 7;
01BF:           ar    = 0;
01C0:           P0  = # INTVB_ENTRY_TABLE
                // Int7~1
            init_intVectTable_lp:
01C2:           AR  =PM[P0++]
01C3:           io[intVect]   = ar;
01C4:           loop    init_intVectTable_lp
            
                // Dis-int-vector table access
01C5:           clr   io[STATUS].b13
01C6:           rets
            INTVB_ENTRY_TABLE:
01C7:       DW #INTVB7_ENTRY,#INTVB6_ENTRY,#INTVB5_ENTRY,#INTVB4_ENTRY,#INTVB3_ENTRY,#INTVB2_ENTRY,#INTVB1_ENTRY,#INTVB0_ENTRY
            ;=========================Include <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\system_inti.asm> END=========================
            
            ;=========================Include By <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\user_code.asm>=========================
            keyscanini:
                // KeyScan I/O Port initial
                //AR    = 0xC000
                //IO[IOC_PA]  = AR    // PortA ->Input
                //ar  =0
                //IO[IOC_PA]  = AR    // PortA ->Input
                // KeyScan variable initial
                //CX    = MARTRIXLINE ;3
01CF:           ar = 0xf0
01D0:           IO[IOC_PA] |= ar  //PortA.b4 PortA.b5 PortA.b6 PortA.b7 Output
01D1:           ar = 0x0f
01D2:           IO[PortA] &= ar
                
01D3:           ar = 0x3f         //0x1f
01D4:           IO[IOC_PB] |= ar  //PortB.b0 PortB.b1 PortB.b2 PortB.b3 PortB.b4 Output
01D5:           ar = 0xC0
01D6:           IO[PortB] &= ar
                
01D7:           ar = 0x7f
01D8:           IO[IOC_PB] &= ar  //PortB.b7 Input
01D9:           ar = 0x80
01DA:           IO[IOC_PC] = ar  // PortC.b0~b6 -> Input
                ;;IO[IOC_PC] |= ar  // PortC.b7 -> Output
                
                INITKEY_FLAG:
01DB:           I0    = scnkeyvuff
01DD:           AR    =0
01DE:           RM[I0++]  =AR
01DF:           AR    =0xff;0XFF
01E0:           ah    =0
01E1:           RM[I0++]  =AR
01E2:           RM[I0++]  =AR
                //lOOP    INITKEY_FLAG
01E3:           rets
            
                
                
            VolumeUp:         	//        03: VOLUME UP
01E4:       	pch = MidivouleUp	
01E5:       	lcall	MidivouleUp
01E6:       	Jmp	Keyrelease
            
            VolumeDown:       //        04: VOLUME DOWN
01E7:       	pch = Midivouledown
01E8:       	lcall	Midivouledown
01E9:           jmp   Keyrelease
            
            
            
            StopAll:            //        05: STOP
                // clear all key press Stop all
01EA:           Pch	=Midioff
01EB:           Lcall	Midioff
01EC:           RETS    //jmp nochabgevolume1
            
            
            DirectKEY:
            
01ED:           AR    = IO[Real_T]
01EE:           rm[_31us] =ar
01EF:           i0    = keypressbuff
01F1:           R1    = 0
01F2:           ar    = 0;
01F3:           RM[MTASKREQ]  = AR;
01F4:           rm[TOTALKEY]  = ar
            SCANKEYLOOP:
            
01F5:           I1    =scnkeyvuff
            
01F7:           ax    = RM[I1++];RM[KEY_FLAG] Key_State_temp
01F8:           bx    = RM[I1++];RM[DIRKEY] Key_State_New
01F9:           dx    = RM[I1++];RM[DKTIMER]  Key_State_Old
            
01FA:           ar    = io[PortA]
01FB:           AR    =AR^0XFF
            
01FC:           ah    =0
01FD:           AX    =ar
01FE:           AR         ^=bX
01FF:           R0    =AR
            
0200:           ar    =ax
0201:           bx    =ar
            
0202:           ar    =R0
0203:           JNZ   Restart_Debounce//jeq   Restart_Debounce
            
0204:           AR    =rm[_last31us]
0205:           R2    =AR
0206:           ar    =rm[_31us]
            
0207:           ar    -=R2
0208:           r0              = rm[i1]
0209:           ar    +=r0
020A:           rm[i1]    =ar
020B:           R2    =0x800   // times
020D:           sf    =ar-R2
020E:           jnc   KM@EXIT //jGE   KM@EXIT
020F:           ar    =0
0210:           rm[i1]    = ar      // reset debounce
0211:           ar    = dx
0212:           ax    = ar
0213:           ar    = bx
0214:           dx    = ar
0215:           r0    = 0
0216:           ar    = ar ^ Ax
            
0217:           jzr     KM@EXIT //jeq   KM@EXIT
0218:           r3    =ar
0219:           ax    &=ar
            
            keyreleasez:
021A:           R2    = 1
021B:           push cx
021C:           cx    =7
                KM@L005@RUN_CMDT:
021D:           test    r3.b0
021E:           jzr    KM@L005@RUN_CMD
                //jNz   KM@L005@RUN_CMDt1
                //jmp   KM@L005@RUN_CMD
                KM@L005@RUN_CMDt1:
021F:           clr   r0.b7
0220:           test    ax.b0
0221:           jNz   KM@L005@RUN_CMDt2
0222:           set   r0.b7
                KM@L005@RUN_CMDt2:
0223:           ar    =keypressbuff
0225:           ar    +=0x0f
0226:           sf    =ar-i0
0227:           jnc   KM@L005@RUN_CMDEXIT
0228:           AR    =R2
0229:           AR    |=R0
022A:           rm[i0++]  =AR
022B:           RM[MTASKREQ]  = AR;
022C:           R1++;
                KM@L005@RUN_CMD:
022D:           sra   r3
022E:           sra   ax
022F:           ar    =r3
0230:           jeq            KM@L005@RUN_CMDEXIT
0231:           r2++
0232:           LOOP    KM@L005@RUN_CMDT
                KM@L005@RUN_CMDEXIT:
0233:           pop cx
            
            Restart_Debounce:
0234:           ar    =0
0235:           rm[i1]    =ar
            KM@EXIT:
0236:           I1    =scnkeyvuff
            
0238:           RM[I1++]  = ax    ; save to RM
0239:           RM[I1++]  = bx
023A:           RM[I1++]  = dx
            
023B:           AR=   3
023C:           ar    =ar^cx
023D:           jnz   KM@EXIT1
023E:           ar    =r1
023F:           jnz   KM@EXIT2 // skip key board
            
            
            KM@EXIT1:
            
            //    LOOP    SCANKEYLOOP
            KM@EXIT2:
0240:           AR    =rm[_31us]
0241:           rm[_last31us] =ar
0242:           AR    =R1
0243:           RM[TOTALKEY]  =AR
            
            KM@EXIT3:
            //    POP CX
0244:           RETS
            
            
            checkKey:
0245:           AR    = RM[MTASKREQ]
                //IO[PortB]   = AR;     // Output Display Key status
0246:           jzr     checkKeyret
0247:           ar    =RM[TOTALKEY]
0248:           ar--
0249:           cx    = ar
            TotalkeypressRelease:
024A:           i1    =keypressbuff
024C:           ar    =cx
024D:           i1    +=ar
024E:           AR    =RM[I1]
024F:           ar--
0250:           RM[MTASKREQ]  =AR
            
0251:           TEST    AR.B7 // KEY RELEASE NOT USE
0252:           JNZ             Keyrelease
            
0253:           p0    = #functionswitch
0255:           p0    +=ar
0256:           ar    =RM[MTASKREQ]
0257:           P0	=Pm[P0]
0258:           fjmp  pm[p0]
                
            Keyrelease:
0259:       		Clr	Ar.b7
025A:           p0    = #Releaskey_proc
025C:           p0    +=ar
025D:           P0	=Pm[P0]
025E:           fjmp  pm[p0]
025F:           nop
0260:           LOOP    TotalkeypressRelease
            
            checkKeyret:
0261:           AR    =0
0262:           RM[MTASKREQ]  =AR
0263:           rets
            
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            DealLoopPlay:
            		;;push ax
            		;;push p0
0264:       		ax = 0x0FFFF
0266:           ar = rm[loop_play_flag]
0267:           sf = ar - ax
0268:           jnz  Deaend
            
0269:           ar = rm[_MIDIFLAG]
026A:           test ar.b1
026B:           jnz Deaend
            	
026C:           ar = rm[PlayFlag]
026D:           jnz Deaend
                
026E:           ar = rm[AdPcmflag]
026F:           ar &= 0x0002
0270:           jnz Deaend
                
0271:           ar = rm[loop_play_length]
0272:           jzr ClrLoopPlay
                
                //////
                ;;i1	=Flag1  
                ;;ar  = 1   
                ;;rm[i1] = ar
                /////
            
0273:           ar = 0
0274:           rm[timer_05ms] = ar
                
0275:           ar = rm[loop_play_addr]
0276:           p0 = ar
0277:           ar = pm[p0]
                
0278:           test ar.b15
0279:           jzr  PlayWav
027A:           clr ar.b15
                
027B:           dsi
027C:           ax = 0
027D:           rm[AdPcmflag] = ax
027E:           eni
                
027F:       		rm[PlayMidi] 	=	ar
0280:       		p0++
0281:       		rm[loop_play_addr] = p0
0282:       		pch =	PlayMidiCommand
0283:       		lcall	PlayMidiCommand
0284:       		ar = rm[loop_play_length]
0285:       		ar--
0286:       		rm[loop_play_length] = ar 
0287:           pch = Deaend
0288:           ljmp Deaend
                    
            PlayWav:
            		;;push ar
            		;;pop ar
0289:           rm[adp_unmber] = ar
028A:           p0++
028B:           rm[loop_play_addr] = p0
028C:           ar = 1 
028D:           rm[adp_ch_index] = ar 
028E:           pch   = play_adpcm_inti
028F:           lcall	play_adpcm_inti
0290:           ar = rm[loop_play_length]
0291:       		ar--
0292:       		rm[loop_play_length] = ar 
0293:           pch = Deaend
0294:           ljmp Deaend
            
            ClrLoopPlay:
0295:           ar = 0
0296:           rm[loop_play_flag] = ar
0297:           rm[PlayFlag] = ar
0298:           rm[_MIDIFLAG] = ar
0299:           ar = rm[Mode_flag]
029A:       		jzr Deaend
029B:           pch = StopAlllPlaying
029C:           lcall StopAlllPlaying
029D:           ar = rm[Mode_flag]
029E:           sf = ar - 4
029F:           jnz Deaend
                
02A0:           ar = 0x0ffff
02A2:           rm[loop_play_flag] = ar   
02A3:           ar = #TestPlayAllT
02A5:           rm[loop_play_addr] = ar
02A6:       		ar = 0x0080
02A8:       	  rm[loop_play_length] = ar
            	  
            Deaend:
                ;;pop p0
                ;;pop ax
02A9:       		rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            DealGameOnPlay:
            		;;push ax
            		;;push bx
            		;;push cx
            		;;push dx
02AA:       		ar = rm[Mode_flag]
02AB:       		jzr EndDealGameOnPlay   ;;normal mode ignore
            		
02AC:       		sf = ar - 5
02AD:       		jzr EndDealGameOnPlay   ;;sleep mode ignore
            		
02AE:       		sf = ar - 4
02AF:       		jge EndDealGameOnPlay   ;;test mode ignore
            		
02B0:       		ar = rm[gmode_state]
02B1:       		sf = ar - 1
02B2:       		jzr WaitWavPlayFinish   ;;;;gmode_state = 1 (wait start wav play finish)
            		
02B3:       		sf = ar - 2
02B4:       		jzr WaitLoopPlayFinish
            		
02B5:       		sf = ar - 3
02B6:       		jzr Gmode_to4
            		
02B7:       		sf = ar - 4
02B8:       		jzr WaitWavPlayFinish
            		
02B9:       		sf = ar - 5
02BA:       		jzr WaitLoopPlayFinish
            		
02BB:       		sf = ar - 6
02BC:       		jzr  Gmode_to6
            		
02BD:       		sf = ar - 7 
02BE:       		jzr WaitLoopPlayFinish
            		
02BF:       		sf = ar - 8
02C0:       		jzr WaitWavPlayFinish
            		
02C1:       		sf = ar - 9
02C2:       		jzr WaitWavPlayFinish
            		
02C3:       		sf = ar - 10
02C4:       		jzr WaitWavPlayFinish 
            		
02C5:       		sf = ar - 12
02C6:       		jzr WaitLoopPlayFinish
            		
02C7:       		sf = ar - 13
02C8:       		jzr WaitLoopPlayFinish
            		
02C9:       		sf = ar - 14
02CA:       		jzr WaitLoopPlayFinish
            		
02CB:       		sf = ar - 15
02CC:       		jzr WaitLoopPlayFinish
            		
02CD:       		sf = ar - 19
02CE:       		jzr WaitWavPlayFinish
            		
02CF:       		sf = ar - 20
02D0:       		jzr WaitWavPlayFinish
            		
02D1:       		sf = ar - 21
02D2:       		jzr WaitLoopPlayFinish
            		
02D3:       		sf = ar - 22
02D4:       		jzr WaitWavPlayFinish
            		
02D5:       		sf = ar - 23
02D6:       		jzr WaitLoopPlayFinish
            		
02D7:       		sf = ar - 24
02D8:       		jzr WaitAllPlayFinish
            		
02D9:       		sf = ar - 25
02DA:       		jzr WaitKeyVolumeFinish
            		
            WaitMidiPlayFinish:
02DB:       		ar = rm[PlayFlag]
02DC:       		jnz EndDealGameOnPlay
            		
02DD:       		pch = Gmode_to7
02DE:       		ljmp Gmode_to7
            		
            WaitWavPlayFinish:
02DF:       		ar = rm[AdPcmflag]      ;;;;wait wav play finish
02E0:           jnz EndDealGameOnPlay
                
02E1:           ar = rm[gmode_state]
02E2:           sf = ar - 1
02E3:           jzr Gmode_to2
                
02E4:           sf = ar - 4
02E5:           jzr Gmode_to5 
                
02E6:           sf = ar - 8
02E7:           jzr GmodetoSwitch
                
02E8:           sf = ar - 9
02E9:           jzr Gmode_toSleep
                
02EA:           sf = ar - 10
02EB:           jzr Gmode_to11
                
02EC:           sf = ar - 19
02ED:           jzr Gmode_to20
                
02EE:           sf = ar - 20
02EF:           jzr Gmode_to21
                
02F0:           sf = ar - 22
02F1:           jzr Gmode_to23
                
            WaitLoopPlayFinish:           
02F2:           ar = rm[loop_play_flag]
02F3:       	  jnz EndDealGameOnPlay    ;;loop play not end
            	  
02F4:       	  ar = rm[gmode_state]
02F5:           sf = ar - 2
02F6:           jzr Gmode_to3
                
02F7:           sf = ar - 5
02F8:           jzr Gmode_to6
                
02F9:           sf = ar - 6
02FA:           jzr Gmode_to7
                
02FB:           sf = ar - 7
02FC:           jzr Gmode_to8
                
02FD:           sf = ar - 12
02FE:           jzr Gmode_to13
                
02FF:           sf = ar - 13
0300:           jzr Gmode_toSleep
                
0301:           sf = ar - 14
0302:           jzr Gmode_to3
                
0303:           sf = ar - 15
0304:           jzr Gmode_to16
                
0305:           sf = ar - 21
0306:           jzr Gmode_to22
                
0307:           sf = ar - 23
0308:           jzr Gmode_to6
            
            WaitAllPlayFinish:
0309:           pch = StopAlllPlaying
030A:           lcall StopAlllPlaying
            		
030B:           ar = rm[AdPcmflag]      ;;;;wait wav play finish
030C:           jnz EndDealGameOnPlay
                
030D:           ar = rm[PlayFlag]
030E:           jnz EndDealGameOnPlay
            
030F:           ar = rm[_MIDIFLAG]
0310:           test ar.b1
0311:           jnz EndDealGameOnPlay
                
0312:           ar = 0 
0313:           rm[timcount] = ar
                
0314:           ar = rm[mykeyoldvalue]
                
0315:           ax = ar
                
                
                
0316:           ar = rm[Mode_flag]
0317:           sf = ar - 1
0318:           jzr Play1
             
0319:        		ar = ax
             		
031A:        		sf = ar - 27
031B:        		jge Play1
             		
            Play2: 		
031C:        		p0 = #Music_Key2_table
031E:        		pch = PlayKeyValue
031F:        		ljmp PlayKeyValue
             		
            Play1:
0320:       		p0 = #Music_Key_table
            		
            PlayKeyValue:
0322:       		ar = ax
0323:           p0 += ar
0324:           ar = pm[p0]
                
0325:           rm[adp_unmber] = ar
0326:           ar = 1 
0327:           rm[adp_ch_index] = AR 
0328:           pch   = play_adpcm_inti
0329:           lcall	play_adpcm_inti
                
032A:          	ar = 25
032B:           rm[gmode_state] = ar
                
032C:           pch = EndDealGameOnPlay
032D:           ljmp EndDealGameOnPlay
                
            
            WaitKeyVolumeFinish:
032E:       		ar = rm[AdPcmflag]      ;;;;wait key volume finish
032F:           jnz EndDealGameOnPlay
               	
0330:          	ar = 10
0331:           rm[gmode_state] = ar
               	
0332:       		pch = EndDealGameOnPlay
0333:           ljmp EndDealGameOnPlay
            		
            Gmode_to2:
0334:       		ar = 2
0335:       		rm[gmode_state] = ar		;;;;gmode_state = 2
               
0336:       		ar = 0x0ffff
0338:           rm[loop_play_flag] = ar
0339:           ar = #G1G2G3OnSameTableEntry
033B:           p0 = ar
033C:           ar = rm[Mode_flag]
033D:           ar--
033E:           p0 += ar
033F:           ar = pm[p0]
0340:           rm[loop_play_addr] = ar
0341:           ar = 5
0342:           rm[loop_play_length] = ar
            		
0343:       		pch = EndDealGameOnPlay
0344:       		ljmp EndDealGameOnPlay
            
            Gmode_to3:
0345:       		ar = 3
0346:       		rm[gmode_state] = ar		;;;;gmode_state = 3
            		
0347:       		ar = rm[Mode_flag]
0348:       		ar--
0349:       		bx = ar
034A:       		p1 = #G1G2G3MaxCount
034C:       		p1 += ar
034D:       		ax = pm[p1]
            		
034E:       		i1 = game1count
034F:       		i1 += ar
            		
0350:       		ar = rm[i1]
0351:       		sf = ar - ax
0352:       		jle  Gmode_to3_end
            		
0353:       		ar = 0               ;;clear 
0354:       		rm[i1] = ar
            		
            Gmode_to3_end:    
            
0355:       		ar = 0x0000
0356:       		rm[repeat_flag] = ar   ;;clear repeat flag
            		
0357:           pch = EndDealGameOnPlay
0358:       		ljmp EndDealGameOnPlay
            		
            Gmode_to4:
0359:       		ar = 4         
035A:       		rm[gmode_state] = ar    ;;;;gmode_state = 4
            		
035B:       		ar = rm[Mode_flag]
035C:       		ar--
035D:       		bx = ar	
035E:       		i1 = game1count
035F:       		i1 += ar	
0360:       		ar = rm[i1]
            
0361:           dx = ar
0362:           ar = bx
0363:       		p0 = #G1G2G3EntryAddr
0365:       		p0 += ar
0366:       		ar = pm[p0]
0367:       		p0 = ar
0368:       		ar = dx
0369:       		p0 += ar
036A:       		ar = pm[p0]
            
036B:           rm[adp_unmber] = ar  
036C:           ar = 1 
036D:           rm[adp_ch_index] = AR 
036E:           pch   = play_adpcm_inti
036F:           lcall	play_adpcm_inti
                
0370:       		pch = EndDealGameOnPlay
0371:       		ljmp EndDealGameOnPlay
            		
            Gmode_to5:
0372:       		ar = 5
0373:       		rm[gmode_state] = ar   ;;;;gmode_state = 5
            		
0374:       		ar = rm[Mode_flag]
0375:       		ar--
0376:       		bx = ar	
            		
0377:       		ar = 0x0ffff
0379:           rm[loop_play_flag] = ar
                
037A:       		p0 = #G1G2G3WaitEntryAddr
037C:       		ar = bx
037D:       		p0 += ar
037E:       		ar = pm[p0]
037F:           rm[loop_play_addr] = ar
                
0380:           p0 = #G1G2G3WaitPlayLengthEntry
0382:           ar = rm[repeat_flag]
0383:           p0 += ar
0384:           ar  = pm[p0]
0385:           p0 = ar
0386:           ar = bx
0387:           p0 += ar
                
0388:           ar = pm[p0]
0389:           rm[loop_play_length] = ar
                
038A:           ar = 0
038B:       		rm[answer_disable] = ar  ;;;;enable sw1-45
            		
038C:       		ar = 1
038D:       		rm[one_flag] = ar
            		
038E:       		pch = EndDealGameOnPlay
038F:       		ljmp EndDealGameOnPlay
            		
            Gmode_to6:
0390:       		ar = 6
0391:       		rm[gmode_state] = ar   ;;;;gmode_state = 6
            		
0392:       		ar = rm[one_flag]
0393:       		jzr  WaitEnd
            		
0394:       		ar = 0
0395:       		rm[wait_count] = ar
0396:       		ar = 1
0397:       		rm[wait_en] = ar
            	
            		;;ar = 0x0ffff
                ;;rm[loop_play_flag] = ar
                ;;ar = #MidiWaitT
                ;;rm[loop_play_addr] = ar
                ;;ar = 2
                ;;rm[loop_play_length] = ar
                
0398:           ar = 3
0399:       		rm[PlayMidi] 	=	ar
039A:       		pch =	PlayMidiCommand
039B:       		lcall	PlayMidiCommand
                
039C:           ar = 0
039D:           rm[one_flag] = ar
                
039E:           pch = WaitEndEnd
039F:           ljmp WaitEndEnd
                
            
            WaitEnd:
03A0:       		ar = rm[wait_count]
03A1:       		ax = 0x4E20
03A3:       		sf = ar - ax
03A4:       		jle  WaitEndEnd
            		
03A5:       		ar = 0
03A6:       		rm[wait_en] = ar
03A7:       		rm[wait_count] = ar
            		
03A8:       		pch = Gmode_to7
03A9:       		ljmp Gmode_to7
            		
            WaitEndEnd:
03AA:       		pch = EndDealGameOnPlay
03AB:       		ljmp EndDealGameOnPlay	
            
            Gmode_to7:
03AC:       		ar = 7
03AD:       		rm[gmode_state] = ar   ;;;;gmode_state = 7   ;;bgm.mid end
            		
03AE:       	  ar = 0x0ffff
03B0:       		rm[answer_disable] = ar  ;;;;disable sw1-54
            		
03B1:       		ar = rm[timcount]
03B2:       		ar++
03B3:       		rm[timcount] = ar
            		
03B4:       		ar = rm[ngcount]
03B5:       		ar++
03B6:       		rm[ngcount] = ar
            		
03B7:       		ar = 0x0ffff
03B9:           rm[loop_play_flag] = ar
03BA:           ar = #Bubu01208T
03BC:       	  rm[loop_play_addr] = ar
03BD:       	  ar = 4
03BE:       	  rm[loop_play_length] = ar
            
03BF:       		pch = EndDealGameOnPlay
03C0:       		ljmp EndDealGameOnPlay	  
            	  
            Gmode_to8:
03C1:       		ar = 8
03C2:       		rm[gmode_state] = ar   ;;;;gmode_state = 8
            		
03C3:       		ar = rm[timcount]
03C4:       	  sf = ar - 3
03C5:       	  jzr Gmode_to9
            		
03C6:       		ar = rm[ngcount]
03C7:       	  sf = ar - 3
03C8:       	  jzr Gmode_to17
            	  
03C9:       	  ar = rm[Mode_flag]
03CA:       	  sf = ar - 1
03CB:       	  jzr G1NgCount
            		
03CC:       		ar = 0x005A
03CD:       		rm[adp_unmber] = ar
03CE:           ar = 1 
03CF:           rm[adp_ch_index] = AR 
03D0:           pch   = play_adpcm_inti
03D1:           lcall	play_adpcm_inti
                
03D2:           pch = EndDealGameOnPlay
03D3:       		ljmp EndDealGameOnPlay
            		
            	G1NgCount:
03D4:       	  ar = rm[ngcount]
03D5:       	  sf = ar - 2
03D6:       	  jzr Gmode_toRemind 
            		
03D7:       		ar = 0
03D8:       		rm[repeat_flag] = ar
            		
03D9:       		pch = Gmode_to4
03DA:       		ljmp Gmode_to4
            		
            Gmode_to9:
03DB:       		ar = 9
03DC:       		rm[gmode_state] = ar   ;;;;gmode_state = 9
            		
03DD:       		pch = StopAlllPlaying
03DE:       		lcall StopAlllPlaying
            		
03DF:       		ar = 0x0ffff
03E1:           rm[loop_play_flag] = ar
03E2:           ar = #ThankYouT
03E4:       	  rm[loop_play_addr] = ar
03E5:       	  ar = 3
03E6:       	  rm[loop_play_length] = ar
            	  
03E7:       		pch = EndDealGameOnPlay
03E8:       		ljmp EndDealGameOnPlay
            		
            Gmode_to11:
03E9:       		ar = 11
03EA:       		rm[gmode_state] = ar   ;;;;gmode_state = 11
            		
03EB:       		ar = 0
03EC:       		rm[wait_en] = ar
03ED:       		rm[wait_count] = ar
            		
03EE:       		ax = rm[mykeyoldvalue]
03EF:       		ar = rm[Mode_flag]
03F0:       		ar--
03F1:       		bx = ar
            		
03F2:       		p0 = #KeyEntryT
03F4:       		p0 += ar
03F5:       		ar = pm[p0]
03F6:       		p0 = ar
            		
03F7:       		ar = bx
03F8:       		i0 = game1count
03F9:       		i0 += ar
03FA:       		ar = rm[i0]   
            		
03FB:       		p0 += ar
            		
03FC:       		ar = pm[p0]
            		
03FD:       		sf = ar - ax
03FE:       		jzr Gmode_to12
            		
03FF:       		pch = Gmode_to15
0400:       		ljmp Gmode_to15
            
            Gmode_to12:
0401:       		ar = 12
0402:       		rm[gmode_state] = ar   ;;;;gmode_state = 12
            
0403:       		ar = 0x0ffff
0405:           rm[loop_play_flag] = ar
                
0406:           p0 = #RightAnswerT
0408:           ar = rm[okcount]
0409:           p0 += ar 
040A:           ar = pm[p0]
               
040B:           rm[loop_play_addr] = ar
040C:       		ar = 4
040D:       	  rm[loop_play_length] = ar
            	  
040E:       	  ar = 0
040F:       	  rm[ngcount] = ar
            	  
0410:       	  ar = rm[okcount]
0411:       	  ar++
0412:       	  rm[okcount] = ar
            	  
0413:       	  pch = EndDealGameOnPlay
0414:       		ljmp EndDealGameOnPlay
            
            Gmode_to13:
0415:       		ar = 13
0416:       		rm[gmode_state] = ar   ;;;;gmode_state = 13
            
0417:       		ax = 0x0005
            		
0418:       		ar = rm[Mode_flag]
0419:       		sf = ar - 3
041A:       		jnz cmpOKOK
            		
041B:       		ax = 0x0003
            		
             cmpOKOK:
041C:        		ar = rm[okcount]
041D:       		sf = ar - ax
041E:       		jzr Gmode_to9
            		
041F:       		pch = Gmode_to14
0420:       		ljmp Gmode_to14
            		
              ;;PlayGoodJob:
            		;;ar = 0x0ffff
                ;;rm[loop_play_flag] = ar
                ;;ar = #GoodJobT
            		;;rm[loop_play_addr] = ar
            		;;ar = 4
            	  ;;rm[loop_play_length] = ar
            	  
0421:       		pch = EndDealGameOnPlay
0422:       		ljmp EndDealGameOnPlay
            			
            Gmode_to14:
0423:       		ar = 14
0424:       		rm[gmode_state] = ar   ;;;;gmode_state = 14
0425:       		ar = rm[Mode_flag]
0426:       		sf = ar - 1
0427:       		jnz PlayNextQu
            				
0428:       		ar = 0x0ffff
042A:           rm[loop_play_flag] = ar
042B:           ar = #NextQuT1
042D:           rm[loop_play_addr] = ar
042E:       		ar = 4
042F:       	  rm[loop_play_length] = ar
            	  
0430:       	  pch = EndGmode14
0431:       		ljmp EndGmode14
            
            	PlayNextQu:
0432:       		ar = 0x0ffff
0434:           rm[loop_play_flag] = ar
0435:           ar = #NextQuT
0437:           rm[loop_play_addr] = ar
0438:       		ar = 3
0439:       	  rm[loop_play_length] = ar
            
            EndGmode14:	  
043A:       	  ar = rm[Mode_flag]
043B:       		ar--
            		
043C:       		i0 = game1count
043D:       		i0 += ar
043E:       		ar = rm[i0]
043F:       		ar++
0440:       		rm[i0] = ar
            	  
0441:       		pch = EndDealGameOnPlay
0442:       		ljmp EndDealGameOnPlay
            
            Gmode_to15:
0443:       		ar = 15
0444:       		rm[gmode_state] = ar   ;;;;gmode_state = 15
            		
0445:       		ar = rm[ngcount]
0446:       		ar++
0447:       		rm[ngcount] = ar
            		
0448:       		ar--
0449:       		p0 = #WrongAnswerT
044B:       		p0 += ar
            		
            	PlayWrongAnswer:
044C:       		ar = 0x0ffff
044E:           rm[loop_play_flag] = ar
                
044F:           ar = pm[p0]
                
0450:           rm[loop_play_addr] = ar
0451:       		ar = 4
0452:       	  rm[loop_play_length] = ar
            	  
            	  
0453:       		pch = EndDealGameOnPlay
0454:       		ljmp EndDealGameOnPlay
            
            Gmode_to16:
0455:       		ar = 16
0456:       		rm[gmode_state] = ar   ;;;;gmode_state = 16
            		
0457:       		ar = rm[ngcount]
0458:       		sf = ar - 3
0459:       		jzr Gmode_to17
            		
045A:       		sf = ar - 2
045B:       		jzr G2modeSwitch
            		
045C:       		pch = SeToGmode_to4
045D:       		ljmp SeToGmode_to4
            		
            G2modeSwitch:
045E:       		ar = rm[Mode_flag]
045F:       		sf = ar - 2
0460:       		jzr SeToGmode_to4
            		
0461:       		pch = Gmode_toRemind
0462:       		ljmp Gmode_toRemind
            		
            SeToGmode_to4:
            
0463:       		ar = 1
0464:       		rm[repeat_flag] = ar
            		
0465:       		pch = Gmode_to4
0466:       		ljmp Gmode_to4
            		
            Gmode_to17:
0467:       		ar = 17
0468:       		rm[gmode_state] = ar   ;;;;gmode_state = 17
            		
0469:       		ax = 0x0005
            		
046A:       		ar = rm[Mode_flag]
046B:       		sf = ar - 3
046C:       		jnz cmpOK
            		
              cmpOK3:
046D:       		ax = 0x0003
            		
              cmpOK:
046E:       		ar = 0
046F:       		rm[ngcount] = ar
            		
0470:       		ar = rm[okcount]
0471:       		ar++
0472:       		rm[okcount] = ar
            		
0473:       		sf = ar - ax
0474:       		jzr Gmode_to9
            		
0475:       		pch = Gmode_to14
0476:       		ljmp Gmode_to14
            
            GmodetoSwitch:
0477:       		ar = rm[Mode_flag]
0478:       		sf = ar - 2            ;;;; G2 directly to C3
0479:       		jzr Deal2Gm4
            		
047A:       		ar = rm[ngcount]
047B:       		sf = ar - 2
047C:       		jzr Gmode_toRemind
            
            Deal2Gm4:		
047D:       		ar = 1
047E:       		rm[repeat_flag] = ar
047F:       		pch = Gmode_to4
0480:       		ljmp Gmode_to4
            		
            Gmode_toSleep:
0481:       		ar = 5
0482:       		rm[Mode_flag] = ar
0483:       		pch = EndDealGameOnPlay
0484:       		ljmp EndDealGameOnPlay
            	 
            Gmode_toRemind:
0485:       		ar = 18                ;;;;Remind(18)
0486:       		rm[gmode_state] = ar   ;;;;gmode_state = 18
            		
            		;;pch = Gmode_to20
            		;;ljmp Gmode_to20
            		
            ;;Gmode_to19:
            		;;ar = 19                
            		;;rm[gmode_state] = ar   ;;;;gmode_state = 19
            		
            		;;ar = 0x005A
            		;;rm[adp_unmber] = ar
                ;;ar = 1 
                ;;rm[adp_ch_index] = AR 
                ;;pch   = play_adpcm_inti
                ;;lcall	play_adpcm_inti
                
                ;;pch = EndDealGameOnPlay
                ;;ljmp EndDealGameOnPlay
            
            Gmode_to20:
0487:       		ar = 20               
0488:       		rm[gmode_state] = ar   ;;;;gmode_state = 20
            		
0489:       		ar = rm[Mode_flag]
048A:       		ar--
048B:       		bx = ar	
048C:       		i1 = game1count
048D:       		i1 += ar	
048E:       		ar = rm[i1]
            
048F:           dx = ar
0490:           ar = bx
0491:       		p0 = #G1G2G3EntryAddr3
0493:       		p0 += ar
0494:       		ar = pm[p0]
0495:       		p0 = ar
0496:       		ar = dx
0497:       		p0 += ar
0498:       		ar = pm[p0]
            
0499:           rm[adp_unmber] = ar
049A:           ar = 1 
049B:           rm[adp_ch_index] = AR 
049C:           pch   = play_adpcm_inti
049D:           lcall	play_adpcm_inti
            		
049E:       		ar = 0
049F:       		rm[answer_disable] = ar  ;;;;enable sw1-54
            		
04A0:       		pch = EndDealGameOnPlay
04A1:           ljmp EndDealGameOnPlay
                
            Gmode_to21:
04A2:       		ar = 21               
04A3:       		rm[gmode_state] = ar   ;;;;gmode_state = 21
            		
              
04A4:       		ar = 0x0ffff
04A6:           rm[loop_play_flag] = ar
04A7:           ar = rm[Mode_flag]
04A8:           sf = ar - 1
04A9:           jzr RT1
04AA:           ar = #RemindT3
04AC:           jmp PlayRemind
            RT1:
04AD:       		ar = #RemindT1
            		
            PlayRemind:
04AF:           rm[loop_play_addr] = ar
                
04B0:           ar = rm[Mode_flag]
04B1:           sf = ar - 1
04B2:           jzr Ar2
                
04B3:           ar = 3
                
04B4:           pch = SetLength
04B5:           ljmp SetLength
                
             Ar2:
04B6:        		ar = 2
            
             SetLength:		
04B7:       	  rm[loop_play_length] = ar
            	  
04B8:       		pch = EndDealGameOnPlay
04B9:           ljmp EndDealGameOnPlay
            
            Gmode_to22:
04BA:       		ar = 22               
04BB:       		rm[gmode_state] = ar   ;;;;gmode_state = 22
            		
04BC:       		ar = rm[Mode_flag]
04BD:       		ar--
04BE:       		bx = ar	
04BF:       		i1 = game1count
04C0:       		i1 += ar	
04C1:       		ar = rm[i1]
            
04C2:           dx = ar
04C3:           ar = bx
04C4:       		p0 = #G1G2G3EntryAddr2
04C6:       		p0 += ar
04C7:       		ar = pm[p0]
04C8:       		p0 = ar
04C9:       		ar = dx
04CA:       		p0 += ar
04CB:       		ar = pm[p0]
            
04CC:           rm[adp_unmber] = ar
04CD:           ar = 1 
04CE:           rm[adp_ch_index] = AR 
04CF:           pch   = play_adpcm_inti
04D0:           lcall	play_adpcm_inti
                
04D1:       		pch = EndDealGameOnPlay
04D2:           ljmp EndDealGameOnPlay
            
            Gmode_to23:
04D3:       		ar = 23              
04D4:       		rm[gmode_state] = ar   ;;;;gmode_state = 23
            		
04D5:       		ar = rm[Mode_flag]
04D6:       		sf = ar - 1
04D7:       		jzr PlayRemindG1
04D8:       		sf = ar - 3
04D9:       		jzr PlayRemindG3  
            		
              PlayRemindG3:
04DA:       		ar = 0x0ffff
04DC:       		rm[loop_play_flag] = ar
04DD:       		ar = #G3RemindT
04DF:       		rm[loop_play_addr] = ar
04E0:       		ar = 3
04E1:       	  rm[loop_play_length] = ar
            	  
04E2:       	  pch = EndDealGameOnPlayW
04E3:           ljmp EndDealGameOnPlayW
            	  
              PlayRemindG1:
04E4:       		ar = 0x0ffff
04E6:       		rm[loop_play_flag] = ar
04E7:       		ar = #G1RemindT
04E9:       		rm[loop_play_addr] = ar
04EA:       		ar = 4
04EB:       	  rm[loop_play_length] = ar
            	  
            EndDealGameOnPlayW:
04EC:       	  ar = 1
04ED:       		rm[one_flag] = ar
            
            EndDealGameOnPlay:
                ;;pop dx
                ;;pop cx
                ;;pop bx 
            		;;pop ax
04EE:       		rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            DealKeyMseeage:
            		;;push i0
            		;;push i1
            		;;push ax
            		;;push bx
            		
04EF:       		i0 = mykeycnt
04F0:       		ar = rm[i0]
            		
04F1:       		ax = 1000
            		
04F3:       		sf = ar - ax
04F4:       		jne Dend
            		
04F5:       		ax = rm[mycheckkeybuff]
            		
04F6:       		ar = ax
04F7:       		sf = ar - 61
04F8:       		jnz  Game3
            		
04F9:       		IO[CLRWDT]  = AR
            		
04FA:       		ar = rm[Mode_flag]
04FB:       		sf = ar - 4
04FC:       		jzr TestGame3
            	
04FD:       		ar = 5
04FE:       		rm[Mode_flag] = ar
                
                ;;ar = 0
                ;;rm[loop_play_addr] = ar
                ;;rm[loop_play_length] = ar
                ;;rm[loop_play_flag] = ar
                ;;rm[loop_play_num] = ar
                
            		;;pch = StopAlllPlaying
            		;;lcall StopAlllPlaying
            		
            		;;ar = 0
            		;;rm[_MIDIFLAG] = ar
            		;;rm[AdPcmflag] = ar
            		
04FF:       		pch = Dend
0500:       		ljmp Dend		
            		
            Game3:
0501:       		sf = ar - 60
0502:       		jzr DealG3
0503:       		ar = rm[Mode_flag]
0504:       		jzr Game2ClearLoopPlayFlag
0505:       		sf = ar - 4
0506:       		jzr Game2ClearLoopPlayFlag
0507:       		ar = ax
0508:       		pch = Game2
0509:       		ljmp Game2
            		
            DealG3:
050A:       		ar = rm[Mode_flag]
050B:       		sf = ar - 4
050C:       		jzr TestGame3
            		
050D:       		pch = StopAlllPlaying
050E:       		lcall StopAlllPlaying
            		
            		
            		
050F:       		ar = 3
0510:       		rm[Mode_flag] = ar
0511:       	  pch = G1toG3Deal
0512:       	  ljmp G1toG3Deal
            	  	
            TestGame3:
0513:       		ar = 0x0ffff
0515:           rm[loop_play_flag] = ar   
0516:           ar = #TestPlayAllT
0518:           rm[loop_play_addr] = ar
0519:       		ar = 0x0080
051B:       	  rm[loop_play_length] = ar
            	  
051C:       		pch = Dend
051D:       		ljmp Dend
            		
            Game2ClearLoopPlayFlag:
051E:       		ar = 0   
051F:       		rm[loop_play_flag] = ar
0520:       		rm[loop_play_num] = ar
0521:       		ar = ax
            Game2:
0522:       		sf = ar - 59
0523:       		jnz  Game1
            		
0524:       		ar = rm[Mode_flag]
0525:       		sf = ar - 4
0526:       		jzr TestGame2
            		
0527:       		pch = StopAlllPlaying
0528:       		lcall StopAlllPlaying
            		
0529:       		ar = 2
052A:       		rm[Mode_flag] = ar
052B:       	  pch = G1toG3Deal
052C:       	  ljmp G1toG3Deal
            		
            TestGame2:
052D:       		ar = rm[count_num]
052E:       		p0 = #TestPlayModeT
0530:       		p0 += ar
0531:       		ar = pm[p0]
0532:       		test ar.b15
0533:       		jzr TestGame2Wav
            		
0534:       		clr ar.b15
0535:       		rm[PlayMidi] 	=	ar
0536:       		pch =	PlayMidiCommand
0537:       		lcall	PlayMidiCommand
            		
0538:       		pch = Dend
0539:       		ljmp Dend
            		
            TestGame2Wav:
053A:       		rm[adp_unmber] = ar
053B:           ar = 2 
053C:           rm[adp_ch_index] = AR 
053D:           pch   = play_adpcm_inti
053E:           lcall	play_adpcm_inti
                
053F:       		pch = Dend
0540:       		ljmp Dend
            		
            Game1:		
0541:       		sf = ar - 58
0542:       		jnz  MymidiStart
            		
0543:       		ar = rm[Mode_flag]
0544:       		sf = ar - 4
0545:       		jzr TestGame1
            		
0546:       		pch = StopAlllPlaying
0547:       		lcall StopAlllPlaying
            		
0548:       		ar = 1
0549:       		rm[Mode_flag] = ar
054A:       	  pch = G1toG3Deal
054B:       	  ljmp G1toG3Deal
            
            TestGame1:
054C:       		ar = rm[count_num]
054D:       		ar++
054E:       		sf = ar - 116
054F:       		jle copy_count
0550:       		ar = 0
            copy_count:		
0551:       		rm[count_num] = ar
            		
0552:       		ar = 93
0553:           rm[adp_unmber] = ar
0554:           ar = 2 
0555:           rm[adp_ch_index] = AR 
0556:           pch   = play_adpcm_inti
0557:           lcall	play_adpcm_inti
            		
0558:       		pch = Dend
0559:       		ljmp Dend
            		
            G1toG3Deal:
055A:           ar = 1
055B:           rm[gmode_state] = ar  ;;;;start game mode
055C:           ar = 0x0ffff
055E:           rm[answer_disable] = ar ;;;;disable sw1-54
                
055F:           ar = rm[Mode_flag]   
0560:       		ar--
            		
0561:           i0 = game1count
0562:           i0 += ar
0563:           ar = rm[i0] 
0564:           ar++
0565:           rm[i0] = ar
                
0566:           ar = 0
0567:           rm[okcount] = ar
0568:           rm[ngcount] = ar
0569:           rm[timcount] = ar
                
056A:           rm[loop_play_addr] = ar
056B:           rm[loop_play_length] = ar
056C:           rm[loop_play_flag] = ar
056D:           rm[loop_play_num] = ar
                
056E:           ar = 0x0001         
056F:           rm[gmode_state] = ar
                
0570:           ar = rm[Mode_flag]   
0571:       		ar--
0572:           p0 = #G1G2G3OnTable
0574:           p0 += ar
                
                
0575:           ar = pm[p0]
                
0576:       		pch = PlayMyWav
0577:       		ljmp PlayMyWav
            		
            MymidiStart:		
0578:       		sf = ar - 55
0579:       		jnz  Mymidi
            				
057A:       		ar = rm[Mode_flag]
057B:       		sf = ar - 4
057C:       		jzr TestModeM1 
            
057D:       		ar = 0
057E:       		rm[Mode_flag] = ar
057F:       		ar = 1
0580:       		rm[gmode_state] = ar
            		
0581:       		pch = StopAlllPlaying
0582:       		lcall StopAlllPlaying
            		
0583:       		ar = 109
0584:       		pch = PlayMyWavCh2
0585:       		ljmp PlayMyWavCh2
            		
            TestModeM1:
0586:       		ar = 0
0587:       		rm[PlayMidi] 	=	ar
0588:       		pch =	PlayMidiCommand
0589:       		lcall	PlayMidiCommand
            		
058A:       		pch = Dend
058B:       		ljmp Dend
            		
            Mymidi:
058C:       		sf = ar - 56
058D:       		jnz  Mymidi1
            		
058E:       		ar = rm[Mode_flag]
058F:       		sf = ar - 4
0590:       		jzr TestModeM2
            		
0591:       		pch = StopAlllPlaying
0592:       		lcall StopAlllPlaying
            		
0593:       		ar = 0
0594:       		rm[Mode_flag] = ar
0595:       		ar = 1
0596:       		rm[gmode_state] = ar
            		
0597:       		ar = 112
0598:       		pch = PlayMyWavCh2
0599:       		ljmp PlayMyWavCh2
            		
            TestModeM2:	
059A:       		ar = 1
059B:       		rm[PlayMidi] 	=	ar
059C:       		pch =	PlayMidiCommand
059D:       		lcall	PlayMidiCommand
            		
059E:       		pch = Dend
059F:       		ljmp Dend
            		
            Mymidi1:
05A0:       		sf = ar - 57
05A1:       		jnz Myplaywav
            		
05A2:       		ar = rm[Mode_flag]
05A3:       		sf = ar - 4
05A4:       		jzr TestModeM3
            
05A5:       		ar = 0
05A6:       		rm[Mode_flag] = ar
05A7:       		ar = 1
05A8:       		rm[gmode_state] = ar
            		
05A9:       		pch = StopAlllPlaying
05AA:       		lcall StopAlllPlaying
            		
05AB:       		ar = 111
05AC:       		pch = PlayMyWavCh2
05AD:       		ljmp PlayMyWavCh2
            		
            TestModeM3:		
05AE:       		ar = 2
05AF:       		rm[PlayMidi] 	=	ar
05B0:       		pch =	PlayMidiCommand
05B1:       		lcall	PlayMidiCommand
            
05B2:       	  pch = Dend
05B3:       		ljmp Dend
            		
            PlayMyWavCh2:
            
05B4:           rm[adp_unmber] = ar
05B5:           ar = 0
05B6:           rm[adp_ch_index] = AR 
05B7:           pch   = play_adpcm_inti
05B8:           lcall	play_adpcm_inti
                
05B9:       		pch = Dend
05BA:       		ljmp Dend
            
            Myplaywav:
05BB:       		ar = rm[Mode_flag]
05BC:       		jzr NormalModeSw1to54
            		
05BD:       		sf = ar - 4
05BE:       		jzr TestModeSw1to54
            		
            GameModeSw1to54:		
05BF:       		ar = rm[answer_disable]
05C0:       		jnz GameModeSw1to54End
            		
05C1:       		pch = StopAlllPlaying
05C2:       		lcall StopAlllPlaying
            		
05C3:       		ar = 0x0ffff
05C5:       		rm[answer_disable] = ar    ;;;;disable all key
            		
05C6:       		ar = 0
05C7:       		rm[timcount] = ar
            		
05C8:       		ar = 0x0018                  
05C9:       		rm[gmode_state] = ar      ;;;;gmode_state = 24  wait stop all playing finish
            		
05CA:       		ar = rm[mycheckkeybuff]
05CB:       		rm[mykeyoldvalue] = ar
            		
05CC:       		ar = 0
05CD:       		rm[PlayFlag] = ar
05CE:       		rm[_MIDIFLAG] = ar
            		
            GameModeSw1to54End:
            		
05CF:       		pch = Dend
05D0:       		ljmp Dend
            	
            NormalModeSw1to54:
05D1:           ar = ax
05D2:           sf = ar - 27
05D3:           jge ClearOldKeyValue
                
05D4:           bx = rm[mykeyoldvalue]
05D5:       		ar = bx
05D6:           sf = ar - ax
05D7:           jnz  TestModeSw1to54
                
05D8:           bx = 0
05D9:           rm[mykeyoldvalue] = bx
                
            SwitchT_Play: 
            		
05DA:       		ar = 0x0ffff
05DC:           rm[loop_play_flag] = ar
                
05DD:           ar = ax
05DE:           p0 = #Music1_6T
05E0:       		p0 += ar
05E1:       		ar = pm[p0]
05E2:           rm[loop_play_addr] = ar
                
05E3:           ar = ax
05E4:           p0 = #Music1_6_Num_T
05E6:           p0 += ar
05E7:           ar = pm[p0]
05E8:       	  rm[loop_play_length] = ar
            
05E9:       		pch = Dend
05EA:       		ljmp Dend
            
            TestModeSw1to54:
05EB:       		bx = rm[mycheckkeybuff]
05EC:       		rm[mykeyoldvalue] = bx
05ED:       		pch = LoadKeyTable
05EE:       		ljmp LoadKeyTable
            		
            ClearOldKeyValue:	
05EF:           bx = 0
05F0:           rm[mykeyoldvalue] = bx
                
05F1:           ar = ax
05F2:           sf = ar - 44
05F3:           jle LoadKeyTable
                
05F4:           sf = ar - 50
05F5:           jge LoadKeyTable
                
05F6:           ar = ar - 45
                
05F7:           p0 = #AnimalT
                
05F9:           p0 += ar
                
05FA:           ar = pm[p0]
            		
05FB:       		pch = PlayMyWav
05FC:       		ljmp PlayMyWav
                
            LoadKeyTable:    
05FD:       		ar = #Music_Key_table
05FF:       		ar += ax			
0600:       		p0 = ar
            	
0601:       		ar = pm[p0]
            	
            PlayMyWav:
            
0602:           rm[adp_unmber] = ar
0603:           ar = 1 
0604:           rm[adp_ch_index] = AR 
0605:           pch   = play_adpcm_inti
0606:           lcall	play_adpcm_inti
            
            Dend:
            		;;pop bx
            		;;pop ax
            		;;pop i1
            		;;pop i0
0607:       		rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            MyCheckKey:
            		;;push i0
            		;;push i1
            		;;push ax
            		;;push bx
            		;;push cx
            		
0608:       		cx = 16
0609:       		i0 = mycheckkeycnt                                  
060A:       		i1 = myscankeycnt  
060B:       		ar = rm[i1]
060C:       		sf = ar - 1
            		
060D:       		jzr clear_debounce
            		
060E:       		ar = rm[key_debounce]
060F:       		ar++
0610:       		ax = 1000
0612:       		sf = ar - ax
0613:       		jnz copy_debounce
            		
0614:       		ar = 0
0615:       		rm[key_debounce] = ar
            		
0616:       		pch = clearall
0617:       		ljmp clearall
            		
            copy_debounce:
0618:       		rm[key_debounce] = ar
0619:       		pch = comp
061A:       		ljmp comp
            		
            clear_debounce:
061B:       		ar = 0
061C:       		rm[key_debounce] = ar
            comp:
061D:       		ar = rm[i1]
061E:       		ax = ar
061F:       		ar = rm[i0]
0620:       		sf = ax -ar
0621:       		jnz copy
0622:       		i0++
0623:       		i1++
0624:       		loop comp
0625:       		pch = cntadd1
0626:       		ljmp  cntadd1
            		
            copy:
0627:           cx = 16	
0628:           i0 = mycheckkeycnt                                  
0629:       		i1 = myscankeycnt
            co:
062A:       		ar = rm[i1]
062B:       		rm[i0] = ar
062C:       		i0++
062D:       		i1++
062E:       		loop co
            
            clearkeycnt:		
062F:       		i0 = mykeycnt
0630:       		ar = rm[i0]
0631:       		ax = 1001              ;;;;skip when powen on because of mykeycnt = 1001
0633:       		sf = ar - ax
0634:       		jzr MyCheckKeyEnd
0635:       		ar = 0
0636:       		rm[i0] = ar
0637:       		pch = MyCheckKeyEnd
0638:       		ljmp MyCheckKeyEnd
            		
            cntadd1:
0639:       		ax = 1000
063B:       		i0 = mykeycnt
063C:       		ar = rm[i0]
063D:       		ar++
063E:       		sf = ar - ax
063F:       		jle  copymykeycnt
            		
0640:       		ar = 1001
            		
            copymykeycnt:
0642:       		rm[i0] = ar
0643:       		pch = MyCheckKeyEnd
0644:       		ljmp MyCheckKeyEnd
            		
            clearall:
0645:       		cx = 35
0646:       		i0 = myscankeycnt   ;; clear en
0647:       		ar = 0
            cl0:		
0648:       		rm[i0++] = ar
0649:       		loop cl0
            		 
            MyCheckKeyEnd:
            		;;pop cx
            		;;pop bx
            		;;pop ax
            		;;pop i1
            		;;pop i0
064A:       		rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 
            MyKeyscan:                                                  
            				;;push ax                                             
            				;;push bx                                             
            				;;push cx                                             
            				;;push dx                                             
            				                                          
064B:       				clr IO[PortA].b4                                    
064C:       				clr IO[PortA].b5                                    
064D:       				clr IO[PortA].b6                                    
064E:       				clr IO[PortA].b7                                    
064F:       				clr IO[PortB].b0                                    
0650:       				clr IO[PortB].b1                                    
0651:       				clr IO[PortB].b2                                    
0652:       				clr IO[PortB].b3                                    
0653:       				clr IO[PortB].b4                                    
            				                                                    
0654:       				i0 = myscankeybuff                                  
0655:       				i1 = myscankeycnt                                             
0656:       				ar = 0                                              
0657:       				ax = ar                                             
0658:       				bx = ar                                             
0659:       				cx = ar                                             
065A:       				dx = ar
065B:       				rm[i1] = ar           ;;清按键数                                             
            				                                                    
065C:       				ah = 0                                              
065D:       				ar = IO[PortC]                                      
065E:       				ar &= 0x7f                                          
            				                                                    
065F:       				jnz MyKeyscanHWErrorDeal                            
            		                                                        
0660:       				set IO[PortA].b4                                    
0661:       				clr IO[PortA].b5                                    
0662:       				clr IO[PortA].b6                                    
0663:       				clr IO[PortA].b7                                    
0664:       				clr IO[PortB].b0                                    
0665:       				clr IO[PortB].b1                                    
0666:       				clr IO[PortB].b2                                    
0667:       				clr IO[PortB].b3                                    
0668:       				clr IO[PortB].b4
0669:       				p0 = #TL0                               
                                                                        
            Myscanstart:				                                        
066B:       				ar = IO[PortC]                                      
066C:       				jzr L1                                              
066D:       				test ar.b0                                          
066E:       				jzr H1                                              
066F:       				nop                                                 
0670:       				nop                                                 
0671:       				nop                                                 
0672:       				test ar.b0                                          
0673:       				jzr H1                                              
0674:       				bx = 0                                              
0675:       				rm[i0++] = PM[p0]  
0676:       				dx = rm[i1]
0677:       				dx++
0678:       				rm[i1] = dx                        
0679:       				pch = L1                                            
067A:       				ljmp L1        ;;屏蔽其他按键                       
            H1:     
067B:       				p0++                                                    
067C:       				test ar.b1                                          
067D:       				jzr  H2                                             
067E:       				nop                                                 
067F:       				nop                                                 
0680:       				nop                                                 
0681:       				test ar.b1                                          
0682:       				jzr  H2                                             
0683:       				bx = 1                                              
0684:       				rm[i0++] = PM[p0]
0685:       				dx = rm[i1]
0686:       				dx++
0687:       				rm[i1] = dx                                          
0688:       				pch = L1                                            
0689:       				ljmp L1			;;屏蔽其他按键	                        
            H2:     
068A:       				p0++                                                  
068B:       				test ar.b2                                          
068C:       				jzr  H3                                             
068D:       				nop                                                 
068E:       				nop                                                 
068F:       				nop                                                 
0690:       				test ar.b2                                          
0691:       				jzr H3                                              
0692:       				bx = 2                                              
0693:       				rm[i0++] = PM[p0]   
0694:       				dx = rm[i1]
0695:       				dx++
0696:       				rm[i1] = dx                                        
0697:       				pch = L1                                            
0698:       				ljmp L1			;;屏蔽其他按键	                        
            H3:     
0699:       				p0++                                                    
069A:       				test ar.b3                                          
069B:       				jzr  H4                                             
069C:       				nop                                                 
069D:       				nop                                                 
069E:       				nop                                                 
069F:       				test ar.b3                                          
06A0:       				jzr  H4                                             
06A1:       				bx = 3                                              
06A2:       				rm[i0++] = PM[p0]     
06A3:       				dx = rm[i1]
06A4:       				dx++
06A5:       				rm[i1] = dx                                      
06A6:       				pch = L1                                            
06A7:       				ljmp L1			;;屏蔽其他按键	                        
            H4:	    
06A8:       				p0++                                                    
06A9:       				test ar.b4                                          
06AA:       				jzr H5                                              
06AB:       				nop                                                 
06AC:       				nop                                                 
06AD:       				nop                                                 
06AE:       				test ar.b4                                          
06AF:       				jzr H5                                              
06B0:       				bx = 4                                              
06B1:       				rm[i0++] = PM[p0]  
06B2:       				dx = rm[i1]
06B3:       				dx++
06B4:       				rm[i1] = dx                                         
06B5:       				pch = L1                                            
06B6:       				ljmp L1			;;屏蔽其他按键	                        
            H5:     
06B7:       				p0++                                                    
06B8:       				test ar.b5                                          
06B9:       				jzr H6                                              
06BA:       				nop                                                 
06BB:       				nop                                                 
06BC:       				nop                                                 
06BD:       				test ar.b5                                          
06BE:       				jzr H6                                              
06BF:       				bx = 5                                              
06C0:       				rm[i0++] = PM[p0] 
06C1:       				dx = rm[i1]
06C2:       				dx++
06C3:       				rm[i1] = dx                                         
06C4:       				pch = L1                                            
06C5:       				ljmp L1			;;屏蔽其他按键	                        
            H6:     
06C6:       				p0++                                                    
06C7:       				test ar.b6                                          
06C8:       				jzr  L1                                             
06C9:       				nop                                                 
06CA:       				nop                                                 
06CB:       				nop                                                 
06CC:       				test ar.b6                                          
06CD:       				jzr  L1                                             
06CE:       				bx = 6                                              
06CF:       				rm[i0++] = PM[p0] 
06D0:       				dx = rm[i1]
06D1:       				dx++
06D2:       				rm[i1] = dx                                          
06D3:       				pch = L1                                            
06D4:       				ljmp L1			;;屏蔽其他按键	                        
            L1:     
06D5:       				p0 = #TL1                                                    
06D7:       				test IO[PortA].b4                                   
06D8:       				jzr L2                                              
06D9:       				clr IO[PortA].b4                                    
06DA:       				set IO[PortA].b5                                    
06DB:       				clr IO[PortA].b6                                    
06DC:       				clr IO[PortA].b7                                    
06DD:       				clr IO[PortB].b0                                    
06DE:       				clr IO[PortB].b1                                    
06DF:       				clr IO[PortB].b2                                    
06E0:       				clr IO[PortB].b3                                    
06E1:       				clr IO[PortB].b4                                    
06E2:       				ax = 1                                              
06E3:       				pch = Myscanstart                                   
06E4:       				ljmp Myscanstart                                    
            				                                                    
            L2:     
06E5:       				p0 = #TL2                                                    
06E7:       				test IO[PortA].b5                                   
06E8:               jzr L3                                              
06E9:               clr IO[PortA].b4                                    
06EA:       				clr IO[PortA].b5                                    
06EB:       				set IO[PortA].b6                                    
06EC:       				clr IO[PortA].b7                                    
06ED:       				clr IO[PortB].b0                                    
06EE:       				clr IO[PortB].b1                                    
06EF:       				clr IO[PortB].b2                                    
06F0:       				clr IO[PortB].b3                                    
06F1:       				clr IO[PortB].b4                                    
06F2:       				ax = 2                                              
06F3:       				pch = Myscanstart                                   
06F4:       				ljmp Myscanstart                                    
                                                                        
            L3:     
06F5:       				p0 = #TL3                                                    
06F7:       				test IO[PortA].b6                                   
06F8:       				jzr L4                                              
06F9:       				clr IO[PortA].b4                                    
06FA:       				clr IO[PortA].b5                                    
06FB:       				clr IO[PortA].b6                                    
06FC:       				set IO[PortA].b7                                    
06FD:       				clr IO[PortB].b0                                    
06FE:       				clr IO[PortB].b1                                    
06FF:       				clr IO[PortB].b2                                    
0700:       				clr IO[PortB].b3                                    
0701:       				clr IO[PortB].b4                                    
0702:       				ax = 3                                              
0703:       				pch = Myscanstart                                   
0704:       				ljmp Myscanstart                                    
            				                                                    
            L4:     
0705:       				p0 = #TL4                                                    
0707:       				test IO[PortA].b7                                   
0708:       				jzr  L5                                             
0709:       				clr IO[PortA].b4                                    
070A:       				clr IO[PortA].b5                                    
070B:       				clr IO[PortA].b6                                    
070C:       				clr IO[PortA].b7                                    
070D:       				set IO[PortB].b0                                    
070E:       				clr IO[PortB].b1                                    
070F:       				clr IO[PortB].b2                                    
0710:       				clr IO[PortB].b3                                    
0711:       				clr IO[PortB].b4                                    
0712:       				ax = 4                                              
0713:       				pch = Myscanstart                                   
0714:       				ljmp Myscanstart                                    
            				                                                    
            L5:     
0715:       				p0 = #TL5                                                    
0717:       				test IO[PortB].b0                                   
0718:       				jzr  L6                                             
0719:       				clr IO[PortA].b4                                    
071A:       				clr IO[PortA].b5                                    
071B:       				clr IO[PortA].b6                                    
071C:       				clr IO[PortA].b7                                    
071D:       				clr IO[PortB].b0                                    
071E:       				set IO[PortB].b1                                    
071F:       				clr IO[PortB].b2                                    
0720:       				clr IO[PortB].b3                                    
0721:       				clr IO[PortB].b4                                    
0722:       				ax = 5                                              
0723:       				pch = Myscanstart                                   
0724:       				ljmp Myscanstart                                    
            				                                                    
            L6:     
0725:       				p0 = #TL6                                                    
0727:       				test IO[PortB].b1                                   
0728:       				jzr L7                                              
0729:       				clr IO[PortA].b4                                    
072A:       				clr IO[PortA].b5                                    
072B:       				clr IO[PortA].b6                                    
072C:       				clr IO[PortA].b7                                    
072D:       				clr IO[PortB].b0                                    
072E:       				clr IO[PortB].b1                                    
072F:       				set IO[PortB].b2                                    
0730:       				clr IO[PortB].b3                                    
0731:       				clr IO[PortB].b4                                    
0732:       				ax = 6                                              
0733:       				pch = Myscanstart                                   
0734:       				ljmp Myscanstart                                    
                                                                        
            L7:     
0735:       				p0 = #TL7                                                    
0737:       				test IO[PortB].b2                                   
0738:       				jzr L8                                              
0739:       				clr IO[PortA].b4                                    
073A:       				clr IO[PortA].b5                                    
073B:       				clr IO[PortA].b6                                    
073C:       				clr IO[PortA].b7                                    
073D:       				clr IO[PortB].b0                                    
073E:       				clr IO[PortB].b1                                    
073F:       				clr IO[PortB].b2                                    
0740:       				set IO[PortB].b3                                    
0741:       				clr IO[PortB].b4                                    
0742:       				ax = 7                                              
0743:       				pch = Myscanstart                                   
0744:       				ljmp Myscanstart                                    
                                                                        
            L8:     
0745:       				p0 = #TL8                                                    
0747:       				test IO[PortB].b3                                   
0748:       				jzr  L0                                             
0749:       				clr IO[PortA].b4                                    
074A:       				clr IO[PortA].b5                                    
074B:       				clr IO[PortA].b6                                    
074C:       				clr IO[PortA].b7                                    
074D:       				clr IO[PortB].b0                                    
074E:       				clr IO[PortB].b1                                    
074F:       				clr IO[PortB].b2                                    
0750:       				clr IO[PortB].b3                                    
0751:       				set IO[PortB].b4                                    
0752:       				ax = 8                                              
0753:       				pch = Myscanstart                                  
0754:       				ljmp Myscanstart                                   
            				                                                    
            L0:     
0755:       				p0 = #TL0                                                    
0757:       				test IO[PortB].b4                                   
0758:       				jzr  L1                                             
0759:       				set IO[PortA].b4                                    
075A:       				clr IO[PortA].b5                                    
075B:       				clr IO[PortA].b6                                    
075C:       				clr IO[PortA].b7                                    
075D:       				clr IO[PortB].b0                                    
075E:       				clr IO[PortB].b1                                    
075F:       				clr IO[PortB].b2                                    
0760:       				clr IO[PortB].b3                                    
0761:       				clr IO[PortB].b4                                    
0762:       				ax = 0                                              
0763:       				pch = MyKeyscanEnd                                   
0764:       				ljmp MyKeyscanEnd                                    
            				                                                    
            				;;clr IO[PortA].b4                                  
            				;;set IO[PortA].b5                                  
            				;;ar = IO[PortC]                                    
            				;;jzr  L1                                           
            				                                                    
            MyKeyscanHWErrorDeal:                                       
                    ;;                                                  
                    ;; Hardware Error!                                       
            				;;                                                  
            								                                            
            MyKeyscanEnd:                                               
            				;;pop dx                                              
            				;;pop cx                                              
            				;;pop bx                                              
            				;;pop ax                                              
0765:       				rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            
            //---------------------------------------
            F_IOSetDelayTimer:	
0766:       	push			cx
0767:       	cx		=	0x0020
            L_IOSetDelayTimerLoop:	
0768:       	IO[CLRWDT]	=	ar
0769:       	nop
076A:       	loop		L_IOSetDelayTimerLoop
076B:       	pop			cx
076C:       	rets
            			
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            StopAlllPlaying:
076D:       		pch = StopAll                  
076E:       		lcall StopAll
                
076F:           ar = 0
0770:           rm[PlayFlag] = ar
0771:       		rm[AdPcmflag] = ar
            		
                ;;cx = 0x00ff
                    
                ;;i0 = SUMLH
                
            ;;clrSUMLH:
                ;;ar = 0
                ;;RM[i0++] = ar
                ;;loop clrSUMLH
            
0772:           IO[CLRWDT] = AR
                
0773:       		rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            Wait30s:
            		;;push ax
0774:       		ar = rm[waitflag]
0775:       		sf = ar - 2
0776:       		jnz ClearCount
            		
0777:       		ar = rm[mycheckkeycnt]
0778:       		jnz ClearCount
            
0779:       		ar = rm[Mode_flag]
            		
077A:       		sf = ar - 1
077B:       		jzr ClearCount
            		
077C:       		sf = ar - 2
077D:       		jzr ClearCount
            		
077E:       		sf = ar - 3
077F:       		jzr ClearCount
            		
0780:       		ax = 0x0EA46
            		
0782:       		ar = rm[timer_05ms]
            		
0783:       		sf = ar - ax
0784:       		jnz Wait30sEnd
            		
0785:       		ar = 5
0786:       		rm[Mode_flag] = ar ;;enter sleep
            		
            ClearCount:
0787:       		ar = 0
0788:       		rm[timer_05ms] = ar
            Wait30sEnd:
            		;;pop ax
0789:       		rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            compPB5:
078A:       		test io[PortB].b5
078B:           jzr n000
078C:           clr io[PortB].b5
078D:           pch = bacc
078E:           ljmp bacc
            n000:
078F:       		set io[PortB].b5 
            bacc:		 	
0790:       		rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            Rampdown_Process:
            
0791:       		MACOP		= 0x02;
0792:       		ar		= 0x09
0793:       		CBL		= ar 
0794:       		cx		= 0x03
            		;;ar		= rm[Ramp_UpDown]
0795:       		ax		= ar
0796:       		i0		= rm[MidiPcmOut];
                Dec_fill_lp:
0797:       		ar		= rm[i0]
0798:       		bx		= ar
0799:       		ar		= 0x00
079A:       		rm[i0++]	= ar
079B:       		ar		= bx
079C:       		mx		= ar 
079D:       		ar		= ax
079E:       		mr		= mx*ar;
079F:       		ar		= mr1
07A0:       		io[DACL]	= ar 
07A1:       		io[DACR]	= ar;
07A2:       		ar		= ax
07A3:       		ax 		= 0x010
07A4:       		ar		-= ax
            		;;rm[Ramp_UpDown]	= ar 
07A5:       		Jnc		_RampdownEnd
07A6:       		ax		= ar 
            		
07A7:       		nop
07A8:       		loop		Dec_fill_lp
            		
            		
07A9:       		rm[MidiPcmOut]	= i0;
07AA:       		ar		= ax
            		;;rm[Ramp_UpDown]	= ar 
07AB:       		Jmp		popStack1
            		
            _RampdownEnd:
07AC:       		ar		= 0x00
            		;;rm[Ramp_Flag] = ar 
            		
07AD:       		call		clr_PCMBuf
            popStack1:
            		
            	exit_Rampdown:
07AE:       		rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            ;;;;
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            clr_PCMBuf:
07AF:       		IO[CLRWDT]	=	ar
            		
07B0:           cx=0x1ff
07B2:           ar=0
07B3:           i0=MidiPCMBuf
            clr_PCMBuf_loop:
07B5:           rm[i0++]=ar
                 		
07B6:           nop
07B7:           loop clr_PCMBuf_loop
07B8:           ar		= MidiPCMBuf.n0
07B9:           ah		= MidiPCMBuf.n1
07BA:           rm[MidiPcmIn]	= ar;
07BB:           rm[MidiPcmOut]	= ar; 
07BC:           ar		= 0;
07BD:           FLTI		= ar;
07BE:           FLTI		= ar;
07BF:           FLTI		= ar;
07C0:           FLTI		= ar;
                 		
07C1:           ADPPCM		= ar 
07C2:           ADPPCM		= ar
07C3:           ADPPCM		= ar
07C4:           ADPPCM		= ar
07C5:           FLTA		= ar;
07C6:           ar		= FLTO	
                 		
             		
07C7:        		IO[CLRWDT]	=	ar
07C8:        		cx	= 	25
07C9:        		I0	=	AdpcmFiltBuf
07CB:        		i0++		
07CC:        		i0++
07CD:        		ar	=	0x0000
             		
            L_ClearAdpcmLoop:   
07CE:       		rm[i0++]	=	ar
            		
07CF:           nop	      	
07D0:       	  loop		L_ClearAdpcmLoop
            	      	
07D1:           rets
            ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
            /*-----------------------------------------------------------------------------
            Midi 播放
            ------------------------------------------------------------------------------*/
            PlayMidiCommand:    //        02: MIDI NUMBER
                // clear all key press midi play first
            
            
                //call    offAllKeyPress
07D2:           CALL StopMidi
07D3:           ar    =rm[_MIDIFLAG]
07D4:           set   ar.b3 // start midi
07D5:           rm[_MIDIFLAG] =ar
            
07D6:           rets
                
            /*-------------------------------------------------------
            播放下一个mid
            -------------------------------------------------------*/      
            PlayNextMidiCommand:  //        08: Play next midi
                // clear all key press midi play first
07D7:           CALL StopMidi
07D8:           ar    =rm[_MIDIFLAG]
07D9:           set   ar.b3 // start midi
07DA:           rm[_MIDIFLAG] =ar
07DB:           ar=rm[PlayMidi]
07DC:           ar++
07DD:           rm[PlayMidi]=ar
07DE:           rets
            /*-------------------------------------------------------
            Midi停止播放
            -------------------------------------------------------*/      
            StopMidi:
07DF:           dsi
07E0:           ar  =0
07E1:           rm[_MIDIFLAG] =ar     // clear all midi event
07E2:           rm[PlayFlag] = ar
07E3:           Pch	=Midioff
07E4:           Lcall	Midioff
07E5:           eni
07E6:           rets
            
            changeIns:
07E7:       	Ax		=0				//;instrument
07E8:       	ar		=0				//;channel
07E9:       	i0		=CH_program
07EB:       	i0		+=ar
07EC:       	rm[i0]		=ax
07ED:       	Rets
            	
            Pianokey1:
            
07EE:       	Ar		=0x44
07EF:       	Rm[MTASKREQ]	=Ar
07F0:       	Ar		=0x0b44			//;instrument  high byte is channel information
07F2:       	Rm[Speehnumber]	=Ar
07F3:       	Ar		=0x7fff
07F5:       	Rm[NoteBeat]	=Ar
07F6:       	Ar		=0x03f
07F7:       	Rm[KeyOnvolume]	=Ar
07F8:       	Pch		=MIdiKeyon_init
07F9:       	Lcall		MIdiKeyon_init
07FA:       	Rets
            Pianokey2:
07FB:       	Ar		=0x45
07FC:       	Rm[MTASKREQ]	=Ar
07FD:       	Ar		=0x0c00			//;instrument  high byte is channel information
07FF:       	Rm[Speehnumber]	=Ar
0800:       	Ar		=0x7fff
0802:       	Rm[NoteBeat]	=Ar
0803:       	Ar		=0x03f
0804:       	Rm[KeyOnvolume]	=Ar
0805:       	Pch		=MIdiKeyon_init
0806:       	Lcall		MIdiKeyon_init
0807:       	Rets
            		
            stop_Pianokey1:
0808:       		Cx		=15
            stop_Pianokey1_Loop:
0809:       		Ar		=Cx
080A:       		I1		=CHBuf
080C:       		Slz		Ar,2
080D:       		Slz		Ar,2
080E:       		I1		+=Ar
080F:       		Ar		=13
0810:       		I1		+=Ar
0811:       		Ar		=Rm[I1]
0812:       		Xchg		Ar
0813:       		Ah		=0
0814:       		Sf		=Ar-0x0b
0815:       		If Zr		Jmp stop_Pianokey1_release
0816:       		Loop		stop_Pianokey1_Loop
0817:       		Jmp		stop_Pianokey1_end
            		
            stop_Pianokey1_release:
            
0818:       		 i0      =ADSRPARA
081A:          		 ar      =Cx
081B:           		 ar      +=0x10
081C:           		 i0      +=ar
081D:           		AR      = RM[I0]
081E:           		SRA     AR,2
081F:           		SRA     AR,2
0820:          		 BX      =0X0F00
0822:           		BX      =AR&BX  			//; for fast keyoff
0823:           		SET     BX.B14
0824:           		SET     BX.B15
            
0825:           		i0    = ADSRstatusCNT
0827:           		ar      = Cx
0828:           		i0    += ar
0829:           		rm[i0]  =Bx
            stop_Pianokey1_end:
082A:       		Rets
            		
            		
            stop_Pianokey2:
082B:       		Cx		=15
            stop_Pianokey2_Loop:
082C:       		Ar		=Cx
082D:       		I1		=CHBuf
082F:       		Slz		Ar,2
0830:       		Slz		Ar,2
0831:       		I1		+=Ar
0832:       		Ar		=13
0833:       		I1		+=Ar
0834:       		Ar		=Rm[I1]
0835:       		Xchg		Ar
0836:       		Ah		=0
0837:       		Sf		=Ar-0x0c
0838:       		If Zr		Jmp stop_Pianokey2_release
0839:       		Loop		stop_Pianokey2_Loop
083A:       		Jmp		stop_Pianokey2_end
            		
            stop_Pianokey2_release:
083B:       		i0      =ADSRPARA
083D:          		 ar      =Cx
083E:           		 ar      +=0x10
083F:           		 i0      +=ar
0840:           		AR      = RM[I0]
0841:           		SRA     AR,2
0842:           		SRA     AR,2
0843:          		 BX      =0X0F00
0845:           		BX      =AR&BX  			//; for fast keyoff
0846:           		SET     BX.B14
0847:           		SET     BX.B15
            
0848:           		i0    = ADSRstatusCNT
084A:           		ar      = Cx
084B:           		i0    += ar
084C:           		rm[i0]  =Bx
            stop_Pianokey2_end:
084D:       		Rets
            		
            	
            	
            DONOTHING:
084E:       		Rets	
            functionswitch:
084F:       DW   	#PlayMidiCommand     //        01: MIDI NUMBER
0850:       DW   	#PlayNextMidiCommand   //        00: Play next midi
0851:       DW  	#changeIns    
0852:       DW  	#Pianokey1           //        05: StopAll
0853:       DW   	#Pianokey2          //        05: StopAll
0854:       DW   	#StopMidi   
0855:       DW   	#TempoUp_10              //        06: TEMPO DOWN    jmp   RepeatMidi  
0856:       DW   	#Keyrelease
            
            Releaskey_proc:
0857:       DW   	#DONOTHING
0858:       DW   	#DONOTHING 
0859:       DW   	#DONOTHING 
085A:       DW   	#stop_Pianokey1 
085B:       DW   	#stop_Pianokey2 
085C:       DW   	#DONOTHING 
085D:       DW   	#DONOTHING 
085E:       DW   	#DONOTHING 
085F:       DW   	#DONOTHING 
0860:       DW   	#DONOTHING 
            
            key_table:
            TL0:
0861:       dw	45,
0862:       dw	56,
0863:       dw	37,
0864:       dw  27,
0865:       dw  19,
0866:       dw  10,
0867:       dw  1,
            
            TL1:
0868:       dw	47,
0869:       dw	46,
086A:       dw	38,
086B:       dw  28,
086C:       dw  20,
086D:       dw  11,
086E:       dw  2,
            
            TL2:
086F:       dw	49,
0870:       dw	48,
0871:       dw	39,
0872:       dw  29,
0873:       dw  21,
0874:       dw  12,
0875:       dw  3,
            
            TL3:
0876:       dw	57,
0877:       dw	0,
0878:       dw	40,
0879:       dw  30,
087A:       dw  22,
087B:       dw  13,
087C:       dw  4,
            
            TL4:
087D:       dw	59,
087E:       dw	50,
087F:       dw	41,
0880:       dw  31,
0881:       dw  23,
0882:       dw  14,
0883:       dw  5,
            
            TL5:
0884:       dw	58,
0885:       dw	51,
0886:       dw	42,
0887:       dw  32,
0888:       dw  24,
0889:       dw  15,
088A:       dw  6,
            
            TL6:
088B:       dw	54,
088C:       dw	52,
088D:       dw	36,
088E:       dw  35,
088F:       dw  55,
0890:       dw  18,
0891:       dw  9,
            
            TL7:
0892:       dw	0,
0893:       dw	60,
0894:       dw	44,
0895:       dw  34,
0896:       dw  26,
0897:       dw  17,
0898:       dw  8,
            
            TL8:
0899:       dw	53,
089A:       dw	61,
089B:       dw	43,
089C:       dw  33,
089D:       dw  25,
089E:       dw  16,
089F:       dw  7,
            
            Music_Key_table:
08A0:       dw  0x0000
08A1:       dw  0x0000
08A2:       dw  0x0002
08A3:       dw  0x0004
08A4:       dw  0x0006
08A5:       dw  0x0008
08A6:       dw  0x000A
08A7:       dw  0x000C
08A8:       dw  0x000E
08A9:       dw  0x0010
08AA:       dw  0x0012
08AB:       dw  0x0014
08AC:       dw  0x007A
08AD:       dw  0x0018
08AE:       dw  0x001A
08AF:       dw  0x001C
08B0:       dw  0x001E
08B1:       dw  0x0020
08B2:       dw  0x0022
08B3:       dw  0x0024
08B4:       dw  0x0026
08B5:       dw  0x0028
08B6:       dw  0x002A
08B7:       dw  0x002C
08B8:       dw  0x002E
08B9:       dw  0x0030
08BA:       dw  0x0032
            
08BB:       dw  0x0034
08BC:       dw  0x0035
08BD:       dw  0x0036
08BE:       dw  0x0037
08BF:       dw  0x0038
08C0:       dw  0x0039
08C1:       dw  0x003A
08C2:       dw  0x003B
08C3:       dw  0x003C
08C4:       dw  0x003D
            
08C5:       dw  0x003F
08C6:       dw  0x0041
08C7:       dw  0x003E
08C8:       dw  0x0040
08C9:       dw  0x0045
08CA:       dw  0x0043
08CB:       dw  0x0042
08CC:       dw  0x0044
            
08CD:       dw  0x004B
08CE:       dw  0x004D
08CF:       dw  0x004F
08D0:       dw  0x0051
08D1:       dw  0x0053
08D2:       dw  0x0046
08D3:       dw  0x0047
08D4:       dw  0x0048
08D5:       dw  0x0049
08D6:       dw  0x004A
            
            Music_Key2_table:
08D7:       dw  0x0000
08D8:       dw  0x0072
08D9:       dw  0x0073
08DA:       dw  0x0074
08DB:       dw  0x0007
08DC:       dw  0x0009
08DD:       dw  0x000B
08DE:       dw  0x0075
08DF:       dw  0x000F
08E0:       dw  0x0076
08E1:       dw  0x0013
08E2:       dw  0x0077
08E3:       dw  0x0078
08E4:       dw  0x0019
08E5:       dw  0x001B
08E6:       dw  0x001D
08E7:       dw  0x001F
08E8:       dw  0x0021
08E9:       dw  0x0023
08EA:       dw  0x0079
08EB:       dw  0x0027
08EC:       dw  0x0029
08ED:       dw  0x002B
08EE:       dw  0x002D
08EF:       dw  0x002F
08F0:       dw  0x0031
08F1:       dw  0x0033
            
            StartModeOnTable:
08F2:       dw  0x8006
08F3:       dw  0x008F
08F4:       dw  0x0061
08F5:       dw  0x0000   ;;end
            
            G1G2G3OnTable:
08F6:       dw  0x0055
08F7:       dw  0x006B
08F8:       dw  0x0056
            
            G1G2G3OnSameTableEntry:
08F9:       dw  #G1OnTable
08FA:       dw  #G2OnTable
08FB:       dw  #G3OnTable
            
            G1OnTable:
08FC:       dw  0x008F
08FD:       dw  0x0071
08FE:       dw  0x008F
08FF:       dw  0x005F
0900:       dw  0x008F
0901:       dw  0x0000   ;;end
            
            G2OnTable:
0902:       dw  0x008F
0903:       dw  0x0071
0904:       dw  0x008F
0905:       dw  0x0089
0906:       dw  0x008F
0907:       dw  0x0000   ;;end
            
            G3OnTable:
0908:       dw	0x008F
0909:       dw  0x0071
090A:       dw  0x008F
090B:       dw	0x005E
090C:       dw  0x008F
090D:       dw  0x0000  ;;end
            
            G1G2G3MaxCount:
090E:       dw  25
090F:       dw  43
0910:       dw  14
            
            G1G2G3EntryAddr:
0911:       dw  #MusicT2_1
0912:       dw  #MusicT3_1
0913:       dw  #MusicT4_1
            
            G1G2G3EntryAddr2:
0914:       dw #MusicT2_1
0915:       dw #MusicT3_1
0916:       dw #MusicT4_2
            
            G1G2G3EntryAddr3:
0917:       dw  #MusicT2_2
0918:       dw  #MusicT3_1
0919:       dw  #MusicT4_1
            
            MusicT2_1:
091A:       dw  0x0010
091B:       dw  0x000A
091C:       dw  0x0030
091D:       dw  0x001C
091E:       dw  0x0024
091F:       dw  0x0006
0920:       dw  0x0028
0921:       dw  0x0018
0922:       dw  0x002C
0923:       dw  0x0004
0924:       dw  0x0020
0925:       dw  0x0026
0926:       dw  0x0008
0927:       dw  0x002E
0928:       dw  0x0022
0929:       dw  0x000E
092A:       dw  0x0000
092B:       dw  0x002A
092C:       dw  0x0012
092D:       dw  0x000C
092E:       dw  0x0032
092F:       dw  0x0014
0930:       dw  0x001A
0931:       dw  0x0002
0932:       dw  0x001E
0933:       dw  0x0016
            
            MusicT2_2:
0934:       dw  0x0076
0935:       dw  0x000B
0936:       dw  0x0031
0937:       dw  0x001D
0938:       dw  0x0079
0939:       dw  0x0007
093A:       dw  0x0029
093B:       dw  0x0019
093C:       dw  0x002D
093D:       dw  0x0074
093E:       dw  0x0021
093F:       dw  0x0027
0940:       dw  0x0009
0941:       dw  0x002F
0942:       dw  0x0023
0943:       dw  0x000F
0944:       dw  0x0072
0945:       dw  0x002B
0946:       dw  0x0013
0947:       dw  0x0075
0948:       dw  0x0033
0949:       dw  0x0077
094A:       dw  0x001B
094B:       dw  0x0073
094C:       dw  0x001F
094D:       dw  0x0078
            
            MusicT3_1:
094E:       dw  0x001F
094F:       dw  0x0077
0950:       dw  0x002B
0951:       dw  0x003A
0952:       dw  0x0045
0953:       dw  0x000F
0954:       dw  0x001D
0955:       dw  0x0035
0956:       dw  0x0033
0957:       dw  0x0040
0958:       dw  0x0009
0959:       dw  0x0013
095A:       dw  0x0037
095B:       dw  0x0031
095C:       dw  0x0042
095D:       dw  0x0029
095E:       dw  0x0039
095F:       dw  0x0007
0960:       dw  0x0019
0961:       dw  0x003D
0962:       dw  0x0044
0963:       dw  0x0075
0964:       dw  0x0074
0965:       dw  0x003C
0966:       dw  0x0021
0967:       dw  0x002D
0968:       dw  0x003E
0969:       dw  0x002F
096A:       dw  0x0034
096B:       dw  0x0079
096C:       dw  0x003F
096D:       dw  0x0078
096E:       dw  0x0038
096F:       dw  0x0027
0970:       dw  0x0073
0971:       dw  0x001B
0972:       dw  0x0043
0973:       dw  0x003B
0974:       dw  0x0023
0975:       dw  0x000B
0976:       dw  0x0076
0977:       dw  0x0041
0978:       dw  0x0036
0979:       dw  0x0072
            
            MusicT4_1:
097A:       dw  0x0050
097B:       dw  0x0054
097C:       dw  0x004E
097D:       dw  0x0052
097E:       dw  0x004C
097F:       dw  0x0050
0980:       dw  0x004E
0981:       dw  0x0054
0982:       dw  0x0050
0983:       dw  0x004C
0984:       dw  0x0052
0985:       dw  0x0054
0986:       dw  0x004E
0987:       dw  0x0052
0988:       dw  0x004C
            
            MusicT4_2:
0989:       dw  0x004F
098A:       dw  0x0053
098B:       dw  0x004D
098C:       dw  0x0051
098D:       dw  0x004B
098E:       dw  0x004F
098F:       dw  0x004D
0990:       dw  0x0053
0991:       dw  0x004F
0992:       dw  0x004B
0993:       dw  0x0051
0994:       dw  0x0053
0995:       dw  0x004D
0996:       dw  0x0051
0997:       dw  0x004B
            
            Game1AskT:
0998:       dw  0x008F
0999:       dw  0x0059
099A:       dw  0x008F
099B:       dw  0x0000
            
            Game2AskT:
099C:       dw  0x008F
099D:       dw  0x0059
            ;;dw  0x008F
            ;;dw  0x005F
            ;;dw  0x008F
            ;;dw  0x0000
            
            Game3AskT:
099E:       dw  0x008F
099F:       dw  0x0059
09A0:       dw  0x008F
            ;;dw  0x005E
            ;;dw  0x008F
            ;;dw  0x0000
            
            MidiWaitT:
09A1:       dw  0x008F
09A2:       dw  0x8003
09A3:       dw  0x0000
            
            G1G2G3WaitEntryAddr:
09A4:       dw  #Game1AskT
09A5:       dw  #Game2AskT
09A6:       dw  #Game3AskT
            
            G1G2G3WaitPlayLength:
09A7:       dw  0x0003
09A8:       dw  0x0002
09A9:       dw  0x0002
            
            G1G2G3RWaitPlayLength:
09AA:       dw  0x0003
09AB:       dw  0x0002
09AC:       dw  0x0003
            
            G1G2G3WaitPlayLengthEntry:
09AD:       dw  #G1G2G3WaitPlayLength
09AE:       dw	#G1G2G3RWaitPlayLength
            
            Bubu01208T:
09AF:       dw  0x0090
09B0:       dw  0x8004
09B1:       dw  0x0090
09B2:       dw  0x0069
09B3:       dw  0x0000
            
            ;;GoodJobT:
            ;;dw  0x0090
            ;;dw  0x006E
            ;;dw  0x0090
            ;;dw  0x0062
            ;;dw  0x0000
            
            NextQuT:
09B4:       dw  0x0090
09B5:       dw  0x005C
09B6:       dw  0x0090
09B7:       dw  0x0000
            
            NextQuT1:
09B8:       dw  0x0091
09B9:       dw  0x008F
09BA:       dw  0x005C
09BB:       dw  0x0090
09BC:       dw  0x0000
            
            RightAnswerT:
09BD:       dw  #RightAnswerT0
09BE:       dw  #RightAnswerT1
09BF:       dw  #RightAnswerT2
09C0:       dw  #RightAnswerT0
09C1:       dw  #RightAnswerT1
            
            RightAnswerT0:
09C2:       dw  0x008F
09C3:       dw  0x8005
09C4:       dw  0x008F
09C5:       dw  0x0063
09C6:       dw  0x0000
            
            RightAnswerT1:
09C7:       dw  0x008F
09C8:       dw  0x8005
09C9:       dw  0x008F
09CA:       dw  0x0064
09CB:       dw  0x0000
            
            RightAnswerT2:
09CC:       dw  0x008F
09CD:       dw  0x8005
09CE:       dw  0x008F
09CF:       dw  0x0065
09D0:       dw  0x0000
            
            WrongAnswerT:
09D1:       dw  #WrongAnswerT0
09D2:       dw  #WrongAnswerT1
09D3:       dw  #WrongAnswerT2
            
            
            WrongAnswerT0:
09D4:       dw  0x8004
09D5:       dw  0x008F
09D6:       dw  0x0066
09D7:       dw  0x0090
09D8:       dw  0x0000
            
            WrongAnswerT1:
09D9:       dw  0x8004
09DA:       dw  0x008F
09DB:       dw  0x0067
09DC:       dw  0x0090
09DD:       dw  0x0000
            
            WrongAnswerT2:
09DE:       dw  0x8004
09DF:       dw  0x008F
09E0:       dw  0x0069
09E1:       dw  0x0090
09E2:       dw  0x0000
            
            RemindT3:
09E3:       dw  0x0090
09E4:       dw  0x0058
09E5:       dw  0x0090
09E6:       dw  0x0000
            
            RemindT1:
09E7:       dw  0x0090
09E8:       dw  0x007E
09E9:       dw  0x0000
            
            G1RemindT:
09EA:       dw  0x008F
09EB:       dw  0x0058
09EC:       dw  0x008F
09ED:       dw	0x0059
09EE:       dw  0x0000
            
            G3RemindT:
09EF:       dw  0x008F
09F0:       dw  0x0057
09F1:       dw  0x0090
            ;;dw  0x0090
09F2:       dw  0x0000
            
            ThankYouT:
09F3:       dw  0x0090
09F4:       dw  0x0062
09F5:       dw  0x0090
09F6:       dw  0x0000
            
            AnimalT:
09F7:       dw  0x008A
09F8:       dw  0x008B
09F9:       dw  0x008C
09FA:       dw  0x008D
09FB:       dw  0x008E
            
            TestPlayModeT:
09FC:       dw	0x8006
09FD:       dw  0x0061
09FE:       dw	0x0000 ;;;;
09FF:       dw  0x0072
0A00:       dw	0x0002
0A01:       dw	0x0073
0A02:       dw  0x0004
0A03:       dw  0x0074
0A04:       dw  0x0006
0A05:       dw	0x0007
0A06:       dw	0x0008
0A07:       dw	0x0009
0A08:       dw	0x000A
0A09:       dw	0x000B
0A0A:       dw	0x000C
0A0B:       dw	0x000D
0A0C:       dw	0x000E
0A0D:       dw	0x000F
0A0E:       dw	0x0010
0A0F:       dw	0x0076
0A10:       dw	0x0012
0A11:       dw  0x0013
0A12:       dw  0x0014
0A13:       dw	0x0077
0A14:       dw  0x0016
0A15:       dw  0x0078
0A16:       dw	0x0018
0A17:       dw  0x0019
0A18:       dw  0x001A
0A19:       dw  0x001B
0A1A:       dw  0x001C
0A1B:       dw  0x001D
0A1C:       dw  0x001E
0A1D:       dw  0x001F
0A1E:       dw  0x0020
0A1F:       dw	0x0021
0A20:       dw	0x0022
0A21:       dw	0x0023
0A22:       dw	0x0024
0A23:       dw	0x0079
0A24:       dw	0x0026
0A25:       dw  0x0027
0A26:       dw	0x0028
0A27:       dw	0x0029
0A28:       dw	0x002A
0A29:       dw	0x002B
0A2A:       dw	0x002C
0A2B:       dw	0x002D
0A2C:       dw	0x002E
0A2D:       dw	0x002F
0A2E:       dw	0x0030
0A2F:       dw	0x0031
0A30:       dw	0x0032
0A31:       dw	0x0033
0A32:       dw	0x006D
0A33:       dw	0x0034
0A34:       dw	0x0035
0A35:       dw	0x0036
0A36:       dw	0x0037
0A37:       dw	0x0038
0A38:       dw	0x0039
0A39:       dw	0x003A
0A3A:       dw	0x003B
0A3B:       dw	0x003C
0A3C:       dw	0x003D
0A3D:       dw	0x003F
0A3E:       dw	0x0041
0A3F:       dw	0x003E
0A40:       dw	0x0040
0A41:       dw	0x0045
0A42:       dw	0x0043
0A43:       dw	0x0042
0A44:       dw	0x0044
0A45:       dw	0x0070
0A46:       dw	0x004B
0A47:       dw	0x004C
0A48:       dw	0x004D
0A49:       dw	0x004E
0A4A:       dw	0x004F
0A4B:       dw	0x0050
0A4C:       dw	0x0051
0A4D:       dw	0x0052
0A4E:       dw	0x0053
0A4F:       dw	0x0054
0A50:       dw	0x006F
0A51:       dw	0x0046
0A52:       dw	0x0047  
0A53:       dw 	0x0048  
0A54:       dw  0x0049  
0A55:       dw	0x004A 
0A56:       dw	0x0055
0A57:       dw	0x0071 
0A58:       dw	0x0059
0A59:       dw	0x8003
0A5A:       dw	0x8004
0A5B:       dw	0x0066
0A5C:       dw	0x0067
0A5D:       dw	0x0069
0A5E:       dw	0x0063
0A5F:       dw	0x0064
0A60:       dw	0x0065
0A61:       dw	0x005B
0A62:       dw	0x007E
0A63:       dw	0x005C
0A64:       dw	0x006B
0A65:       dw	0x005F
0A66:       dw	0x005A
0A67:       dw	0x006E
0A68:       dw	0x006A
0A69:       dw	0x0062
0A6A:       dw	0x0060
0A6B:       dw	0x0056
0A6C:       dw	0x005E
0A6D:       dw	0x006C
0A6E:       dw	0x0057
0A6F:       dw	0x8005
0A70:       dw	0x8003
0A71:       dw	0x0000
            
            TestPlayAllT:
0A72:       dw  0x8006
0A73:       dw  0x008F
0A74:       dw  0x0061
0A75:       dw	0x0000 ;;;;
0A76:       dw  0x0072
0A77:       dw	0x0002
0A78:       dw	0x0073
0A79:       dw  0x0004
0A7A:       dw  0x0074
0A7B:       dw  0x0006
0A7C:       dw	0x0007
0A7D:       dw	0x0008
0A7E:       dw	0x0009
0A7F:       dw	0x000A
0A80:       dw	0x000B
0A81:       dw	0x000C
0A82:       dw	0x000D
0A83:       dw	0x000E
0A84:       dw	0x000F
0A85:       dw	0x0010
0A86:       dw	0x0076
0A87:       dw	0x0012
0A88:       dw  0x0013
0A89:       dw  0x0014
0A8A:       dw	0x0077
0A8B:       dw  0x0016
0A8C:       dw  0x0078
0A8D:       dw	0x0018
0A8E:       dw  0x0019
0A8F:       dw  0x001A
0A90:       dw  0x001B
0A91:       dw  0x001C
0A92:       dw  0x001D
0A93:       dw  0x001E
0A94:       dw  0x001F
0A95:       dw  0x0020
0A96:       dw	0x0021
0A97:       dw	0x0022
0A98:       dw	0x0023
0A99:       dw	0x0024
0A9A:       dw	0x0079
0A9B:       dw	0x0026
0A9C:       dw  0x0027
0A9D:       dw	0x0028
0A9E:       dw	0x0029
0A9F:       dw	0x002A
0AA0:       dw	0x002B
0AA1:       dw	0x002C
0AA2:       dw	0x002D
0AA3:       dw	0x002E
0AA4:       dw	0x002F
0AA5:       dw	0x0030
0AA6:       dw	0x0031
0AA7:       dw	0x0032
0AA8:       dw	0x0033
0AA9:       dw	0x006D
0AAA:       dw	0x0034
0AAB:       dw	0x0035
0AAC:       dw	0x0036
0AAD:       dw	0x0037
0AAE:       dw	0x0038
0AAF:       dw	0x0039
0AB0:       dw	0x003A
0AB1:       dw	0x003B
0AB2:       dw	0x003C
0AB3:       dw	0x003D
0AB4:       dw	0x003F
0AB5:       dw	0x0041
0AB6:       dw	0x003E
0AB7:       dw	0x0040
0AB8:       dw	0x0045
0AB9:       dw	0x0043
0ABA:       dw	0x0042
0ABB:       dw	0x0044
0ABC:       dw	0x0070
0ABD:       dw	0x004B
0ABE:       dw	0x004C
0ABF:       dw	0x004D
0AC0:       dw	0x004E
0AC1:       dw	0x004F
0AC2:       dw	0x0050
0AC3:       dw	0x0051
0AC4:       dw	0x0052
0AC5:       dw	0x0053
0AC6:       dw	0x0054
0AC7:       dw	0x006F
0AC8:       dw	0x0046
0AC9:       dw	0x0047  
0ACA:       dw 	0x0048  
0ACB:       dw  0x0049  
0ACC:       dw	0x004A 
0ACD:       dw	0x0055
0ACE:       dw	0x0071 
0ACF:       dw	0x0059
0AD0:       dw	0x8003
0AD1:       dw  0x008F
0AD2:       dw	0x8004
0AD3:       dw  0x008F
0AD4:       dw	0x0066
0AD5:       dw	0x0067
0AD6:       dw	0x0069
0AD7:       dw	0x0063
0AD8:       dw	0x0064
0AD9:       dw	0x0065
0ADA:       dw	0x005B
0ADB:       dw	0x007E
0ADC:       dw	0x005C
0ADD:       dw	0x006B
0ADE:       dw	0x005F
0ADF:       dw	0x005A
0AE0:       dw	0x006E
0AE1:       dw	0x006A
0AE2:       dw	0x0062
0AE3:       dw	0x0060
0AE4:       dw	0x0056
0AE5:       dw	0x005E
0AE6:       dw	0x006C
0AE7:       dw	0x0057
0AE8:       dw	0x8005
0AE9:       dw	0x008F
0AEA:       dw  0x8003
0AEB:       dw  0x0091
0AEC:       dw  0x0091
0AED:       dw  0x0091
0AEE:       dw  0x0091
0AEF:       dw  0x0091
0AF0:       dw  0x0091
0AF1:       dw  0x0091
0AF2:       dw  0x0091
0AF3:       dw  0x0091
0AF4:       dw  0x0091
0AF5:       dw  0x0000
            
            
            
            KeyEntryT:
0AF6:       dw  #KeyT2_1
0AF7:       dw  #KeyT3_1
0AF8:       dw  #KeyT4_1
            
            KeyT2_1:
0AF9:       dw  9  
0AFA:       dw  6
0AFB:       dw  25
0AFC:       dw  15
0AFD:       dw  19
0AFE:       dw  4
0AFF:       dw  21 
0B00:       dw  13
0B01:       dw  23
0B02:       dw  3
0B03:       dw  17
0B04:       dw  20
0B05:       dw  5
0B06:       dw  24
0B07:       dw  18
0B08:       dw  8
0B09:       dw  1
0B0A:       dw  22
0B0B:       dw  10
0B0C:       dw  7
0B0D:       dw  26
0B0E:       dw  11
0B0F:       dw  14
0B10:       dw  2
0B11:       dw  16
0B12:       dw  12
            
            KeyT3_1:
0B13:       dw  16
0B14:       dw  11
0B15:       dw  22
0B16:       dw  33
0B17:       dw  41
0B18:       dw  8
0B19:       dw  15
0B1A:       dw  28
0B1B:       dw  26
0B1C:       dw  40
0B1D:       dw  5
0B1E:       dw  10
0B1F:       dw  30
0B20:       dw  25
0B21:       dw  43
0B22:       dw  21
0B23:       dw  32
0B24:       dw  4
0B25:       dw  13
0B26:       dw  36
0B27:       dw  44
0B28:       dw  7
0B29:       dw  3
0B2A:       dw  35
0B2B:       dw  17
0B2C:       dw  23
0B2D:       dw  39
0B2E:       dw  24
0B2F:       dw  27
0B30:       dw  19
0B31:       dw  37
0B32:       dw  12
0B33:       dw  31
0B34:       dw  20
0B35:       dw  2
0B36:       dw  14 
0B37:       dw  42
0B38:       dw  34
0B39:       dw  18
0B3A:       dw  6
0B3B:       dw  9
0B3C:       dw  38
0B3D:       dw  29
0B3E:       dw  1
            
            KeyT4_1:
0B3F:       dw  47
0B40:       dw  49
0B41:       dw  46
0B42:       dw  48
0B43:       dw  45
0B44:       dw  47
0B45:       dw  46  
0B46:       dw  49
0B47:       dw  47
0B48:       dw  45
0B49:       dw  48
0B4A:       dw  49
0B4B:       dw  46 
0B4C:       dw  48
0B4D:       dw  45
            
            KeySW1:
0B4E:       dw  0x0072
0B4F:       dw	0x008F
0B50:       dw	0x007F
0B51:       dw	0x0000
            
            KeySW2:
0B52:       dw	0x0073
0B53:       dw	0x0000
            
            KeySW3:
0B54:       dw	0x0074
0B55:       dw  0x008F
0B56:       dw	0x0080
0B57:       dw	0x0000
            
            KeySW4:
0B58:       dw	0x0007
0B59:       dw	0x0000
            
            KeySW5:
0B5A:       dw	0x0009
0B5B:       dw	0x008F
0B5C:       dw  0x0081
0B5D:       dw	0x0000
            
            KeySW6:
0B5E:       dw	0x000B
0B5F:       dw	0x0000
            
            KeySW7:
0B60:       dw	0x000D
0B61:       dw	0x0000
            
            KeySW8:
0B62:       dw	0x000F
0B63:       dw	0x008F
0B64:       dw	0x0082
0B65:       dw  0x0000
            
            KeySW9:
0B66:       dw	0x0076
0B67:       dw	0x0000
            
            KeySW10:
0B68:       dw	0x0013
0B69:       dw	0x0000
            
            KeySW11:
0B6A:       dw	0x0077
0B6B:       dw	0x0000
            
            KeySW12:
0B6C:       dw	0x0078
0B6D:       dw	0x008F
0B6E:       dw	0x0083
0B6F:       dw	0x0000
            
            KeySW13:
0B70:       dw	0x0019
0B71:       dw	0x008F
0B72:       dw	0x0084
0B73:       dw	0x0084
0B74:       dw	0x0000
            
            KeySW14:
0B75:       dw	0x001B
0B76:       dw	0x0000
            
            KeySW15:
0B77:       dw	0x001D
0B78:       dw	0x0000
            
            KeySW16:
0B79:       dw	0x001F
0B7A:       dw	0x008F
0B7B:       dw	0x0085
0B7C:       dw	0x0000
            
            KeySW17:
0B7D:       dw  0x0021
0B7E:       dw  0x0000
            
            KeySW18:
0B7F:       dw  0x0023
0B80:       dw	0x0000
            
            KeySW19:
0B81:       dw	0x0079
0B82:       dw	0x0000
            
            KeySW20:
0B83:       dw	0x0027
0B84:       dw	0x008F
0B85:       dw	0x0086
0B86:       dw	0x0000
            
            KeySW21:
0B87:       dw  0x0029
0B88:       dw	0x0000
            
            KeySW22:
0B89:       dw	0x002B
0B8A:       dw  0x008F
0B8B:       dw	0x0087
0B8C:       dw	0x0000
            
            KeySW23:
0B8D:       dw  0x002D
0B8E:       dw	0x0000
            
            KeySW24:
0B8F:       dw	0x002F
0B90:       dw	0x008F
0B91:       dw	0x0088
0B92:       dw	0x0000
            
            KeySW25:
0B93:       dw	0x0031
0B94:       dw	0x0000
            
            KeySW26:
0B95:       dw  0x0033
0B96:       dw	0x0000
            
            Music1_6T:
0B97:       dw  0x0000
0B98:       dw	#KeySW1
0B99:       dw	#KeySW2
0B9A:       dw	#KeySW3
0B9B:       dw	#KeySW4
0B9C:       dw	#KeySW5
0B9D:       dw	#KeySW6
0B9E:       dw	#KeySW7
0B9F:       dw	#KeySW8
0BA0:       dw	#KeySW9
0BA1:       dw	#KeySW10
0BA2:       dw	#KeySW11
0BA3:       dw  #KeySW12
0BA4:       dw	#KeySW13
0BA5:       dw	#KeySW14
0BA6:       dw	#KeySW15
0BA7:       dw	#KeySW16
0BA8:       dw	#KeySW17
0BA9:       dw	#KeySW18
0BAA:       dw	#KeySW19
0BAB:       dw	#KeySW20
0BAC:       dw	#KeySW21
0BAD:       dw	#KeySW22
0BAE:       dw	#KeySW23
0BAF:       dw	#KeySW24
0BB0:       dw	#KeySW25
0BB1:       dw	#KeySW26
            
            Music1_6_Num_T:
0BB2:       dw	0x0000
0BB3:       dw	0x0003
0BB4:       dw	0x0001
0BB5:       dw	0x0003
0BB6:       dw	0x0001
0BB7:       dw	0x0003
0BB8:       dw	0x0001
0BB9:       dw	0x0001
0BBA:       dw	0x0003
0BBB:       dw	0x0001
0BBC:       dw	0x0001
0BBD:       dw	0x0001
0BBE:       dw	0x0003
0BBF:       dw	0x0004
0BC0:       dw	0x0001
0BC1:       dw	0x0001
0BC2:       dw	0x0003
0BC3:       dw	0x0001
0BC4:       dw	0x0001
0BC5:       dw	0x0001
0BC6:       dw	0x0003
0BC7:       dw	0x0001
0BC8:       dw	0x0003
0BC9:       dw	0x0001
0BCA:       dw	0x0003
0BCB:       dw	0x0001
0BCC:       dw	0x0001
            
            
            ;=========================Include <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\user_code.asm> END=========================
            
            ;=========================Include By <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\MIDILIB.ASM>=========================
            
            even_process:
0BCD:       		pch	= SysReliabilityChk
0BCE:       		lcall	SysReliabilityChk
            		
            		;;set IO[PortB].b5
0BCF:       		ar = rm[Mode_flag]
0BD0:       		sf = ar - 5
0BD1:       		jzr even_process_end
            		
0BD2:       		eni
0BD3:        		pch	=	MyKeyscan
0BD4:       		lcall	MyKeyscan
0BD5:       		eni
0BD6:       		pch	=	MyCheckKey
0BD7:       		lcall	MyCheckKey
0BD8:       		eni
0BD9:       		pch = DealKeyMseeage
0BDA:       		lcall DealKeyMseeage
0BDB:       		eni
0BDC:       		pch = DealLoopPlay
0BDD:       		lcall DealLoopPlay
0BDE:       		eni
0BDF:       		pch = DealGameOnPlay
0BE0:       		lcall DealGameOnPlay
0BE1:       		eni
0BE2:       		pch = Wait30s
0BE3:       		lcall Wait30s
            		
            		;;clr IO[PortB].b5
            		
            even_process_end:
0BE4:       		eni
0BE5:       		IO[CLRWDT] = AR
0BE6:       		PCH	= WaitPCM_Empty_size
0BE7:       		Lcall	WaitPCM_Empty_size
0BE8:       		if AN jmp even_process1
0BE9:       		RETS
            		
            even_process1:
0BEA:       		Pch	= PlaySynthy
0BEB:       		Lcall	PlaySynthy
            		
0BEC:       		IO[CLRWDT] 	= AR
0BED:       		rets
            
            /*-----------------------------------------------------------------------------------
            function: midi mark event
            input:	Ar  midi mark volume
            -----------------------------------------------------------------------------------*/
            MidiMarkProc:
0BEE:       		Rets
            		
            /*-----------------------------------------------------------------------------------
            function: to mixed other channel sound
            -----------------------------------------------------------------------------------*/
            OtherSoundadd:
0BEF:       	pch   = Adpcm6chPlay
0BF0:       	lcall	Adpcm6chPlay
            		
            ;	pop  MACOP
0BF1:       	Rets
            		
            ;//////////////////////////		
            /*-----------------------------------------------------------------------------------
            function:  new note event
            -----------------------------------------------------------------------------------*/
            NewnoteSet:
0BF2:       		Rets
            		
            		
            /*-------------------------------------------------------
            一个小节完成
            -------------------------------------------------------*/
            _S_A_MeasureFinished:
              
0BF3:               RETS                             
            /*-------------------------------------------------------
            一拍Y束M
            -------------------------------------------------------*/                                     
            _S_A_BeatFinished:               
              
0BF4:               RETS                             
            /*-------------------------------------------------------
            半拍Y束M
            -------------------------------------------------------*/                                       
            _S_HalfABeatFinished:         
              
0BF5:               RETS
                                            
            /*-------------------------------------------------------
            弯音幅度调整
            -------------------------------------------------------*/
            _S_MidiPitchWheels:
                    //; Do not change any of the registers, in addition to AR
0BF6:               AR = Pitch_wheel_Beat
0BF7:               RETS
                    
            /*-------------------------------------------------------
            新音符处理前 
            Ar＝1不播放当前音符
            -------------------------------------------------------*/
            _S_BeforeANotePlayed:
0BF8:       	Ar	=1
0BF9:       	Rets
            /*-----------------------------------------------------------------------------------
            tempo 改变  从40～3320改变
            -----------------------------------------------------------------------------------*/	
            TempoUp_10:         
0BFA:           ar    =rm[_MIDIFLAG]
0BFB:           test    ar.b1 		//;stop midi
0BFC:           jzr   nochabgetempo
                
0BFD:           i0  = templevelcnt
0BFF:           ar  =rm[i0]
0C00:           ar++
0C01:           test ar.b4
0C02:           jzr TempoUp_10_1
            TempoUp_10_2:   
0C03:           ar  =0
            TempoUp_10_1:         
0C04:           rm[i0]  =ar
0C05:           p1  = #tempstep
0C07:           p1  +=ar
0C08:           ar  =pm[p1]
0C09:           AR++
0C0A:           JZR   TempoUp_10_2
0C0B:           AR--
0C0C:           bx  =ar
0C0D:           ar  =rm[TEMPO1]
0C0E:           ar  +=bx
0C0F:           TEST  AR.B15
0C10:           JNZ TempoUp_10
0C11:           BX  =40
0C12:           SF  =AR-BX
0C13:           JNC      TempoUp_10_3
0C14:           rm[TEMPO1]=ar
0C15:           PCH =init_Tempo
0C16:           Lcall	init_Tempo
0C17:           Jmp	nochabgetempo
            TempoUp_10_3:
0C18:           AR  =40
0C19:           rm[TEMPO1]=ar
0C1A:           PCH =init_Tempo
0C1B:            Lcall	init_Tempo
0C1C:       	Jmp	nochabgetempo
                
            TempoUp:            //        06: TEMPO UP
0C1D:           ar    =rm[_MIDIFLAG]
0C1E:           test    ar.b1 // stop midi
0C1F:           jzr   nochabgetempo
                
0C20:           i0  =rm[TEMPO1]
0C21:           i0++
0C22:           ar  =320
0C24:           sf=ar-i0
0C25:           jnc nochabgetempo
0C26:           ar    =i0
0C27:           rm[TEMPO1] =ar
0C28:          PCH =init_Tempo
0C29:          Lcall	init_Tempo
            nochabgetempo:
0C2A:           rets
            
            TempoDwon:            //        07: TEMPO DOWN
0C2B:           ar    =rm[_MIDIFLAG]
0C2C:           test    ar.b1 // stop midi
0C2D:           jzr   nochabgetempo
                
0C2E:           ar  =rm[TEMPO1]
0C2F:           jzr nochabgetempo
0C30:           ar--
0C31:           jzr nochabgetempo
0C32:           rm[TEMPO1] =ar
0C33:          PCH =init_Tempo
0C34:          Lcall	init_Tempo
0C35:          Rets
                  
            tempstep:
0C36:         dw 00,10,20,30,20,10,0,65526,65516,65506,65516,65526,65535
            /*-----------------------------------------------------------------------------------
            midi 音量减
            -----------------------------------------------------------------------------------*/
            Midivouledown:
0C43:       	ar    =rm[Midi_Volume]
0C44:           	ar    -=0x10
0C45:           	ax    =60
0C46:           	sf    =ax -ar
0C47:           	jnc   VolumeDown1
0C48:           	ar    =60 ;0x0
0C49:           	jmp   VolumeDown1
            VolumeDown1:
0C4A:           	rm[Midi_Volume]=ar
0C4B:           	pch = UpdateVolume
0C4C:           	lcall UpdateVolume
0C4D:       	Rets
            /*-----------------------------------------------------------------------------------
            midi 音量增加
            -----------------------------------------------------------------------------------*/
            MidivouleUp:
0C4E:           ar    =rm[Midi_Volume]
0C4F:           ar    +=0x10
0C50:           sf  = ar- MAX_Midi_Volume
0C51:           jnc update_maxm_volume
0C52:           test  ar.b8
0C53:           jzr   MidivouleUp1
            update_maxm_volume:   
0C54:           al    =MAX_Midi_Volume
0C55:           ah    =0
0C56:           jmp   MidivouleUp1
            MidivouleUp1:
0C57:           	rm[Midi_Volume]=ar
0C58:           	pch = UpdateVolume
0C59:           	lcall UpdateVolume
0C5A:           	Rets
            /*-------------------------------------------------------
            音量更新
            -------------------------------------------------------*/
            UpdateVolume:
0C5B:           PUSH CX
0C5C:           i0  = CHBuf
0C5E:           i1  =Org_CH_VOL   
0C60:           cx  =15
0C61:           ar    = rm[PlayFlag]  
0C62:           r3    =ar
            
              UpdateVolume0:    
0C63:           test  r3.b0
0C64:           jzr   UpdateVolume2
0C65:           ar    =0x0d
0C66:           i0  +=ar
0C67:           ar  =rm[i1]
0C68:           al  =0
0C69:           dx  =ar
0C6A:           xchg  ar
0C6B:           MX  =ar
0C6C:           ar  =rm[i1]
0C6D:           ah  =0
0C6E:           MR  =MX*AR
0C6F:           ar  |=DX
0C70:           rm[i1]  =ar
0C71:           ar  =7
0C72:           i0  -=ar
0C73:           AR  =RM[I0]
0C74:           AH  =0
0C75:           dx  =ar
0C76:           ar  =MR0
0C77:           al  =0
0C78:           XCHG  AR
0C79:           MX  =AR
0C7A:           AR  =rm[Midi_Volume]
0C7B:           MR  =MX*AR
0C7C:           AR  =MR0
0C7D:           AL  =0
0C7E:           ar  |=dx
0C7F:           RM[I0]  =AR
0C80:           AR    =0X0A
0C81:           jmp   UpdateVolume3
              UpdateVolume2:  
0C82:           ar  =0x10
              UpdateVolume3:  
0C83:           I0    +=AR
0C84:           i1++
0C85:           sra r3
0C86:           LOOP  UpdateVolume0
0C87:           POP CX
0C88:           rets
            
            //;包络控制部分的table
            SUSTAINLEVEL:
0C89:       		dw      0,20h,40h,60h,80h,0a0h,0C0h,0e0h
0C91:       		dw      100h,120h,140h,160h,180h,1a0h,1c0h,1e0h
            susvalue:
0C99:       		dw      1122H,3444H		//;1*1000h+1*100h+2*10h+2,3*1000h+4*100h+4*10h+4
0C9B:       		dw      4556H,6777H		//;4*1000h+5*100h+5*10h+6,6*1000h+7*100h+7*10h+7
            panlevel:
            
0C9D:       		dw      0000h,0018h,0040h,0058h,0080h,0098h,00c0h,00ffh
0CA5:       		dw      0ff00h,0ff00h,0C000h,9800h,8000h,5800h,4000h,1800h
            
            Attack_table2:
0CAD:       		dw      3ffh,273h,24ch,21dh,1f6h,1d3h,1b6h
0CB4:       		dw      195h,17bh,161h,147h,134h,11bh
0CBA:       		dw      107h,0f7h,0e4h,0d2h,0c4h,0b8h
0CC0:       		dw      0abh,09bh,08eh,084h,07bh,073h
0CC6:       		dw      069h,05eh,055h,04dh,046h,040h
0CCC:       		dw      03bh,036h,032h,02eh,027h,020h
0CD2:       		dw      01ch,017h,013h,010h,00dh,00ah
0CD8:       		dw      007h,004h,002h,000h                     ; 47
            Attack_table1:
0CDC:       		dw      3ffh,28ch,265h,235h,210h,1edh,1d0h
0CE3:       		dw      1aeh,194h,17ah,160h,14dh,134h
0CE9:       		dw      120h,110h,0feh,0ebh,0ddh,0d1h
0CEF:       		dw      0c4h,0b4h,0a7h,09dh,094h,08dh
0CF5:       		dw      083h,077h,06eh,066h,05fh,059h
0CFB:       		dw      054h,050h,04ch,047h,040h,03ah
0D01:       		dw      035h,030h,02ch,029h,026h,023h
0D07:       		dw      020h,01eh,01bh,019h,018h,016h
0D0D:       		dw      014h,013h,011h,010h,00fh,00eh
0D13:       		dw      00dh,00dh,00ch,00bh,00ah,00ah
0D19:       		dw      008h,007h,005h,004h,003h,001h
0D1F:       		dw      000h                                    ;68
            LEVELPRECENT:
0D20:       Dw   0000h, 3851h, 70A3h, 9999h, 0B333h, 0C7AEh, 0D47Ah, 0E147h
0D28:       Dw   0E666h, 0E8F5h, 0EB85h, 0EE14h, 0F0A3h, 0F333h, 0F5C2h, 0F851h
            LEVELPRECENT1:
            LEVELPOINT:
0D30:       		DW 450,450,450,225,163,102,102,40,20,20,20,20,20,20,20,1,1
            
            
            
            ;=========================Include <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\MIDILIB.ASM> END=========================
            
            ;=========================Include By <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\Spi_ctrl.asm>=========================
            /*---------------------------------------------------------------------------------------------------------------------------
            SPI 初始化
            ---------------------------------------------------------------------------------------------------------------------------*/
            SPI_Initial:
0D41:           	CALL  	SET_SPI_CS_ctrl
0D42:           	Set     	io[STATUS].b8 		//; Enable SPI Control
0D43:           	CALL  	SET_SPI_CS
0D44:           	ar    	= 0x11			;
0D45:           	ah    	= speed			; // speed
0D46:          	 io[SPI_CTL]   = ar			; // send_data = 1;
0D47:           	clr     io[SPI_CTL].b4     // send_data = 0;
0D48:           	pch     =Check_Tran_OK
0D49:           	lcall     Check_Tran_OK
0D4A:           	rets
            /*---------------------------------------------------------------------------------------------------------------------------
            SPI   设定Cs为输出口
            ---------------------------------------------------------------------------------------------------------------------------*/
            SET_SPI_CS_ctrl:
            	#ifdef SPI_TYPE2
              	set     io[ioc_pD].b4 // cs=1
            	#endif
            	#ifdef SPI_TYPE1
0D4B:         	set     io[ioc_pA].b3// cs=1
            	#endif
            	#ifdef TRD16P201A_SPI
              	set     io[ioc_pD].b10 // cs=1
            	#endif
0D4C:         	rets
            /*---------------------------------------------------------------------------------------------------------------------------
            SPI   设定Cs为高电平
            ---------------------------------------------------------------------------------------------------------------------------*/
            SET_SPI_CS:
            	#ifdef SPI_TYPE2
                	set     io[Portd].b4 // cs=1
                	set   io[SPI_CTL].b11
            	#endif
            	#ifdef SPI_TYPE1
0D4D:           	set     io[PortA].b3 // cs=1
0D4E:           	set   io[SPI_CTL].b11
            	#endif
            	#ifdef TRD16P201A_SPI
                	set     io[PortD].b10 // cs=1
            	#endif
0D4F:         	rets
            /*---------------------------------------------------------------------------------------------------------------------------
            SPI   设定Cs为低电平
            ---------------------------------------------------------------------------------------------------------------------------*/
            CLR_SPI_CS:
            	#ifdef SPI_TYPE2
                	clr     io[Portd].b4 // cs=0
                	clr   io[SPI_CTL].b11
            	#endif
            	#ifdef SPI_TYPE1
0D50:           	clr     io[PortA].b3 // cs=0
0D51:           	clr   io[SPI_CTL].b11
            	#endif
            	#ifdef TRD16P201A_SPI
                	clr     io[PortD].b10 // cs=0
            	#endif
0D52:         	rets
            /*---------------------------------------------------------------------------------------------------------------------------
            SPI   查看CS的状态
            ---------------------------------------------------------------------------------------------------------------------------*/
            TEST_SPI_CS:
            	#ifdef SPI_TYPE2
                	test    io[Portd].b4 // cs=1
            	#endif
            	#ifdef SPI_TYPE1
0D53:           	test    io[PortA].b3 // cs=1
            	#endif
            	#ifdef TRD16P201A_SPI
                	test    io[PortD].b10 // cs=1
            	#endif
0D54:         	rets
            /*---------------------------------------------------------------------------------------------------------------------------
            从flash读取4个byte资料
            ---------------------------------------------------------------------------------------------------------------------------*/
            Get_4_BYTE_nowait:
0D55:       		ar 	= 0x24;
            Get_4_BYTE1_nowait:
0D56:       		ah 	= SPI_Speed; // speed
0D57:       		io[SPI_CTL] 	= ar;	// receive_data = 1;
0D58:       		clr 	io[SPI_CTL].b5     	// receive_data = 0;
0D59:       		rets
            /*---------------------------------------------------------------------------------------------------------------------------
            从flash读取1个byte资料
            ---------------------------------------------------------------------------------------------------------------------------*/
            Get_1_BYTE_nowait:
0D5A:       		ar 	= 0x21;
0D5B:       		jmp	Get_4_BYTE1_nowait
            /*---------------------------------------------------------------------------------------------------------------------------
            从flash读取2个byte资料
            ---------------------------------------------------------------------------------------------------------------------------*/
            Get_2_BYTE_nowait:
0D5C:       		ar 	= 0x22;
0D5D:       		jmp	Get_4_BYTE1_nowait
            /*---------------------------------------------------------------------------------------------------------------------------
            从flash读取3个byte资料
            ---------------------------------------------------------------------------------------------------------------------------*/
            Get_3_BYTE_nowait:
0D5E:       		ar 	= 0x23;
0D5F:       		jmp	Get_4_BYTE1_nowait
            /*---------------------------------------------------------------------------------------------------------------------------
            从flash读取8个byte资料
            ---------------------------------------------------------------------------------------------------------------------------*/
            Get_8_BYTE_nowait:
0D60:       		ar 	= 0x28;
0D61:       		jmp	Get_4_BYTE1_nowait
            		
            /*--------------------------------------------------------------------------------------------------------------------
            从flash取数的处理
            使用到寄存器 Ar  P1
            --------------------------------------------------------------------------------------------------------------------*/
            Read_onebyte:
0D62:       		set 	io[SPI_CTL].B6
0D63:       		clr 	io[SPI_CTL].b6
            
0D64:       		AR	=io[SPI_DAT];
0D65:       		set 	io[SPI_CTL].b5
0D66:       		clr 	io[SPI_CTL].b5
0D67:       		AH	=0
0D68:       		rm[DMD]=ar
0D69:       		P1++
0D6A:       		RETS
            
            Get_4_BYTE:
0D6B:       		ar 	= 0x24;
            Get_4_BYTE1:
0D6C:       		ah 	= SPI_Speed; // speed
0D6D:       		io[SPI_CTL] 	= ar;	// receive_data = 1;
0D6E:       		clr 	io[SPI_CTL].b5     	// receive_data = 0;
0D6F:       		jmp	Check_Tran_OK
            
            Get_1_BYTE:
0D70:       		ar 	= 0x21;
0D71:       		jmp	Get_4_BYTE1
            
            Get_2_BYTE:
0D72:       		ar 	= 0x22;
0D73:       		jmp	Get_4_BYTE1
            Get_8_BYTE:
0D74:       		ar 	= 0x28;
0D75:       		jmp	Get_4_BYTE1
            Get_3_BYTE:
0D76:       		ar 	= 0x23;
0D77:       		jmp	Get_4_BYTE1
            		
            /*--------------------------------------------------------------------------------------------------------------------
            等待数据传输完成
            --------------------------------------------------------------------------------------------------------------------*/
            Check_Tran_OK:
0D78:       		test 		io[SPI_CTL].b7
0D79:       		Jzr		Check_Tran_OK//JEQ		Check_Tran_OK
            
            
0D7A:       		set 		io[SPI_CTL].b6     // tran_data_ok = 1
0D7B:       		clr 		io[SPI_CTL].b6     // tran_data_ok = 0
0D7C:       		rets
            /*--------------------------------------------------------------------------------------------------------------------
            设置要读取的位置：
            输入地址  BX  AX （L  H)
            --------------------------------------------------------------------------------------------------------------------*/
            Send_SPI_address:
0D7D:       		PCH	=	TEST_SPI_CS
0D7E:       		LCALL	TEST_SPI_CS
0D7F:       		JNZ		Send_SPI_address1
0D80:       		set 		io[SPI_CTL].b6     // tran_data_ok = 1
0D81:       		clr 		io[SPI_CTL].b6     // tran_data_ok = 0
0D82:       		PCH	=	SET_SPI_CS
0D83:       		LCALL	SET_SPI_CS
            Send_SPI_address1:
0D84:       		PCH	=	CLR_SPI_CS
0D85:       		LCALL	CLR_SPI_CS
            	
0D86:       		ah		=0x03
0D87:       		io[SPI_DAT]	= xchg	ar;		
0D88:       		ar		=bx
0D89:       		io[SPI_DAT] 	= xchg ar;
0D8A:       		ar 		= 0x14;
0D8B:       		ah 		= SPI_Speed; // speed
0D8C:       		io[SPI_CTL] 	= ar;	// send_data = 1;
0D8D:       		clr 		io[SPI_CTL].b4     // send_data = 0;
0D8E:       		call  		Check_Tran_OK
0D8F:       		rets
            /*---------------------------------------------------------------------------------------------------------------------------
            功能应该和前面是一样的
            Ar Bx是地址 BX是低位 AR 是高位
            ---------------------------------------------------------------------------------------------------------------------------*/
            Send_SPI_address_noWait:
0D90:       		PCH		=TEST_SPI_CS
0D91:       		LCALL		TEST_SPI_CS
0D92:       		JNZ		Send_SPI_address_noWait1		;如果CS 为高进行下一步
0D93:       		set 		io[SPI_CTL].b6    
0D94:       		clr 		io[SPI_CTL].b6    
0D95:       		PCH		=SET_SPI_CS
0D96:       		LCALL		SET_SPI_CS
            Send_SPI_address_noWait1:
0D97:       		PCH		=SET_SPI_CS
0D98:       		LCALL		SET_SPI_CS
            
0D99:       		PCH		=CLR_SPI_CS
0D9A:       		LCALL		CLR_SPI_CS
            		
0D9B:       		ah		=0x03
0D9C:       		io[SPI_DAT]	= xchg	ar;
0D9D:       		ar		=bx
0D9E:       		io[SPI_DAT] 	= xchg ar;
            
0D9F:       		ar 		= 0x14;
0DA0:       		ah 		= SPI_Speed; // speed
0DA1:       		io[SPI_CTL] 	= ar;	// send_data = 1;
0DA2:       		clr 		io[SPI_CTL].b4     // send_data = 0;
0DA3:       		rets
            
            //------------------------------------------------------------              
            cs_reset: 
0DA4:       		set		io[SPI_CTL].b6
0DA5:       		clr		io[SPI_CTL].b6
0DA6:       		Set		io[porta].b3
0DA7:       		Clr		io[porta].b3
0DA8:       		rets
            		
            //-------------------------------------------------------------
            Deep_powerdown_cmd:
            		//COMMAND B9H WRITE ENABLE
0DA9:       		Call		cs_reset      
            		
0DAA:       		ar          	= 0x00B9
0DAC:       		io[SPI_DAT]	= ar 
            		  
0DAD:       		ar          	= 0x11
0DAE:       		ah          	= 0x10
0DAF:       		io[SPI_CTL]	=ar 
            		
0DB0:       		clr         	io[SPI_CTL].b4
0DB1:       		call        	Check_Tran_OK
            		
            		;SET_SPI_CS
0DB2:       		set 		io[Porta].b3 // cs=1
            		
0DB3:       		rets
            		
            //-------------------------------------------------------------
            Rel_powerdown_cmd:
            		//COMMAND ABH WRITE ENABLE
0DB4:       		Call		cs_reset      
            		
0DB5:       		ar          	= 0x00ab
0DB7:       		io[SPI_DAT]	=ar 
            		
0DB8:       		ar          	= 0x11
0DB9:       		ah         	= 0x10
0DBA:       		io[SPI_CTL]	=ar 
            		
0DBB:       		clr         	io[SPI_CTL].b4
0DBC:       		call        	Check_Tran_OK
            		
            		;SET_SPI_CS
0DBD:       		set 	   	io[Porta].b3 // cs=1
0DBE:       		rets
            
            		
            wait_flash_ready:      
0DBF:       		io[ClrWDT]	= ar;			// Clear Watch Dog          
0DC0:       		call		read_status_cmd
0DC1:       		test		ar.b0
0DC2:       		if nz 		jmp  wait_flash_ready  ;=1,busy,=0,ready
0DC3:       		rets 
            		
            //-------------------------------------------------------------
            read_status_cmd:                
            		//COMMAND 05H READ STATUS
0DC4:       		Call		cs_reset         
            		
0DC5:       		ar          	= 0x05
0DC6:       		io[SPI_DAT]	= ar 
            		
0DC7:       		ar          	= 0x11
0DC8:       		ah          	= 0x10
0DC9:       		io[SPI_CTL]	=ar 
            		
0DCA:       		clr         	io[SPI_CTL].b4
0DCB:       		call        	check_tran_ok
            		
            		// read ready or busy
0DCC:       		ar          	= 0x21
0DCD:       		ah          	= 0x50
0DCE:       		io[SPI_CTL]	=ar 
            		
0DCF:       		clr         	io[SPI_CTL].b5
0DD0:       		call        	check_tran_ok
            		
0DD1:       		ar          	=io[SPI_DAT]
            		
            		;SET_SPI_CS
0DD2:       		set 		io[Porta].b3 // cs=1 
            		
0DD3:       		rets
            		  
            ;=========================Include <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\Spi_ctrl.asm> END=========================
            
            ;=========================Include By <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\adpcm4.asm>=========================
            ;AdPcmflag   b0-- ch0 b1--ch1,b2--ch2,b3--ch3,b4--ch4,b5--ch5
            ;adp_ch_index  0 表示用第一通道，1表示第二通道 .........
            /* ================================================================= */	
            VarRM[0:127]={
            
            adp_ch_index
            
            AdpcmSample
            adp_vol
            AdPcmflag
            adp_unmber
            adp_spi_adr0
            adp_spi_adr1
            adp_data_temp
            
            };
            // ********************************************************************	
            VarRM[128:511]={
            
            
            
            };
            
            ;// dx is return converted PCM numbers
            ;/////Notice: TRD16P201A Serial  should add Filter OverFlow check procedure.
            #ifdef _TRD16P201A_
            SampelConvert:
            		push	i0
            		call	RestoreToBuff1
            		i0  = 	SUMLH
            		cx		= 0x07f;
            		MACOP  = 1 ; 	
            		nop 	
            SampelConvert_lp:
            		jfa 		filter_out1	// check filter buffer availed
            		jmp		adpcm_dec		
            filter_out1:
            		ar		= FLTO;		// get filter out, and start delay 4 cycle to get next filter out								
            //---------------------- Rounding from 16-bit to 12-bit
              		if an jmp  	rounding_neg
            rounding_pos:
              		slc  		ar 
              		if an jmp  	rounding_pos_sat
              		jmp  		rounding_ok
            rounding_pos_sat:  
              		ar  		= 0x7fff
              		jmp  		rounding_ok
            rounding_neg:
              		slc  		ar 
              		if an jmp  	rounding_neg_ok
              		ar  		= 0x8000
            rounding_neg_ok:  
              		ar  		= ar + 0x0008
            rounding_ok:  
            ;-------------------------------------------------------  			
            		ar  =  rm[adp_vol]   ;
            		mx = ar
            		ar		=FLTO
                  		MR		=MX*AR
                  		bx		= rm[i0]
                  		ar		=mr1
                  		rm[i0++]		= ar+bx
                   		Ar		=Mr2
                   		Bx		=Rm[i0]
                   		rm[i0++] 		= Ar+Bx+c
                   	
            		loop		SampelConvert_lp
            Sampel_End:		
            		call	SaveToBuff1
            		pop	i0
            		rets
            ;;//////////////////////////////////////////////////////////////////			
            #else
            SampelConvert:
0DD4:       		push  i0 
            	
0DD5:       		call	RestoreToBuff1
            		
0DD6:       		i0  = 	SUMLH
0DD8:       		cx		= 0x07f;
0DD9:       		MACOP  = 1 ; 
0DDA:       		nop 		
            SampelConvert_lp:
0DDB:       		jfa 		filter_out1	// check filter buffer availed
0DDC:       		jmp		adpcm_dec		
            filter_out1:
0DDD:       		ar  =  rm[adp_vol]   ;
0DDE:       		mx = ar
0DDF:       		ar		=FLTO
0DE0:             		MR		=MX*AR
0DE1:             		bx		= rm[i0]
0DE2:             		ar		=mr1
0DE3:             		rm[i0++]		= ar+bx
0DE4:              		Ar		=Mr2
0DE5:              		Bx		=Rm[i0]
0DE6:              		rm[i0++] 		= Ar+Bx+c		
            		
0DE7:       		loop		SampelConvert_lp
            Sampel_End:		
0DE8:       		call	SaveToBuff1
            		
0DE9:       		pop  i0 
0DEA:       		rets	
            #endif					
            ;///////////////////////////////////////////////////////////////////////////////////////////////		
            adpcm_dec:
            		// ************************************************
            		//--- Decoder Start
            		// ************************************************				
0DEB:       		ar 		= rm[FrameSample1]
0DEC:       		if nz jmp adpcm_next_sampe
            	
            		// End Check
            		// --------Header Sample ---------------
            		;---------------------------------
0DED:       		bx = rm[adp_spi_adr0]
0DEE:       		ar = rm[adp_spi_adr1]
0DEF:            		pch 	=Send_SPI_address
0DF0:           		lcall 	Send_SPI_address
0DF1:           		pch 	= Get_2_BYTE
0DF2:           		lcall 	Get_2_BYTE
0DF3:           		ar = rm[adp_spi_adr0]
0DF4:       		ar = ar +2
0DF5:       		rm[adp_spi_adr0] = ar
0DF6:       		ar = rm[adp_spi_adr1]
0DF7:       		ar   += c
0DF8:       		rm[adp_spi_adr1] = ar 
0DF9:           		ar 	=io[SPI_DAT]   ; 
0DFA:           		rm[adp_data_temp] =ar						
            		;//---------------------------------------
0DFB:       		ah 		= 0xFF;
0DFC:       		sf 		= ar - 0xff;
0DFD:       		if eq jmp adpcm_end
            		// silence check
0DFE:       		sf 		= ar - 0xEF;
0DFF:       		if eq jmp adpcm_silence
            		
            		//--------Header Sample ---------------						
0E00:       		ar		=rm[adp_data_temp]; pm[p0++]			
            		//--------------------------------------		
0E01:       		ADPHD		= ar		// 16bit header
            		;clr		ar.b0		// not silence frame
0E02:       		ar    =  0	
0E03:       		rm[ZeroFrame_s] = ar           ;
0E04:       		jmp 		adpcm_next_sampe
            adpcm_silence:	
            		;ar		=rm[adp_data_temp]; pm[p0++]		
            		;xchg ar
            		;ah=0	
            		;set		ar.b0;		// silence frame
0E05:       		ar  = 1 ;
0E06:       		rm[ZeroFrame_s] = ar;
            		// Clear S1, S2, S3, S4
0E07:       		ar  		= 0;
0E08:       		ADPPCM	 	= ar;	// s4
0E09:       		ADPPCM	 	= ar;	// s3
0E0A:       		ADPPCM 		= ar;	// s2
0E0B:       		ADPPCM 		= ar;	// s1
            		
0E0C:       		jmp 		adpcm_next_sampe
            adpcm_end:				
0E0D:       		p1 =  #bit_clr_flag   ;
0E0F:          		ar  =  rm[adp_ch_index]
0E10:          		p1 = p1 + ar
0E11:          		ar  = pm[p1]
0E12:          		bx = rm[AdPcmflag]
0E13:       		ar = ar & bx
0E14:       		rm[AdPcmflag] = ar
0E15:       		jmp	Sampel_End
            adpcm_next_sampe:		
0E16:       		ar		= rm[ZeroFrame_s]
            		;test 		ar.b0
0E17:       		jnz 	adpcm_silence_sample
            		// normal sample
            		// --------Get new Sample ---------------
0E18:       		jmp Get_One_Sample
            Get_One_Sample_End:						
0E19:       		ADPDAT 		= ar;			// 8 bit-stram								
            adpcm_silence_sample:
0E1A:       		ar 		= rm[FrameSample1]
0E1B:       		ar++;
0E1C:       		ax=0x20
0E1D:       		sf 		= ar - ax;
0E1E:       		if nz jmp 	adpcm_exit
0E1F:       		ar 		= 0;
            adpcm_exit:		
0E20:       		rm[FrameSample1] = ar;						
0E21:       		jmp filter_out1
            
            ;///////////////////////////////////////////////////////////////////////////////////////////////
            Get_One_Sample:			
0E22:       		ar		= rm[read_flag] ;
0E23:       		sf		= ar-4
0E24:       		if eq jmp Sample
0E25:       		ar++
0E26:       		rm[read_flag]	= ar
0E27:       		ar=rm[ADPCM_Data1]
0E28:       		jmp SendDelta			
            Sample:
0E29:       		ar		= 1
0E2A:       		rm[read_flag]	= ar
            		;-----------------------------
0E2B:       		bx = rm[adp_spi_adr0]
0E2C:       		ar = rm[adp_spi_adr1]
0E2D:            		pch 	=Send_SPI_address
0E2E:           		lcall 	Send_SPI_address
0E2F:           		pch 	= Get_2_BYTE
0E30:           		lcall 	Get_2_BYTE
0E31:           		ar = rm[adp_spi_adr0]
0E32:       		ar = ar +2
0E33:       		rm[adp_spi_adr0] = ar ;
0E34:       		ar = rm[adp_spi_adr1]
0E35:       		ar   += c
0E36:       		rm[adp_spi_adr1] = ar 
0E37:           		ar 	=io[SPI_DAT]   ; 
            		;ar		= pm[p0++]
0E38:       		xchg ar
0E39:       		rm[ADPCM_Data1]	= ar
            SendDelta:
0E3A:       		ax		= ar
0E3B:       		slz ar,2
0E3C:       		slz ar,2
0E3D:       		rm[ADPCM_Data1]	= ar
0E3E:       		ar		= 0xf000
0E40:       		ar		= ar&ax
0E41:       		xchg ar		
0E42:       		jmp	Get_One_Sample_End
            		
            ;/////////////////////////////////////////////
            play_adpcm_inti:
0E43:       	dsi
0E44:       	push	bx
0E45:       	push	p1
0E46:       	push	i1
                	
0E47:         ar = rm[adp_ch_index] ;
0E48:       	p1 = #adpcm_filt_tab
0E4A:       	p1 = p1  + ar
0E4B:       	ar = pm[p1]
0E4C:       	i1   = AdpcmFiltBuf
0E4E:       	i1  = i1 + ar
0E4F:       	ar =  0 
0E50:       	rm[i1++]		=ar;ADPPCM		//;0
0E51:       	rm[i1++]		=ar		//;1
0E52:       	rm[i1++]		=ar		//;2
0E53:       	rm[i1++]		=ar		//;3
0E54:       	rm[i1++]		=ar;FLTA			//;4
0E55:       	ar = rm[AdpcmSample]  
            	;ar		= 0x1FFF ;---adpcm-采样设定 
0E56:       	rm[i1++]		=ar			//;fltp
0E57:       	ar = 0x003f
0E58:       	rm[i1++]		=ar 	//FLTG			//;6     -----
0E59:       	ar  = 0
0E5A:       	rm[i1++]		=  ar ;ADPHD			//;7
0E5B:       	ar = 4
0E5C:       	rm[i1++]		=  ar ;read_flag                 ;8
0E5D:       	ar = 0
0E5E:       	rm[i1++]		=  ar  ;FrameSample1           ;9
0E5F:       	RM[I1++]		=  ar  ;ZeroFrame_s           10
0E60:       	RM[I1++]		=  ar  ;ADPCM_Data1          11
            	;-------------------------
0E61:       	ar = rm[adp_unmber]
0E62:           	slz  ar
0E63:           	slz  ar
0E64:           	ar  = ar + 8 ; ---
0E65:           	bx = ar
0E66:            	Ar	=0
0E67:            	pch 	=Send_SPI_address
0E68:           	lcall 	Send_SPI_address
0E69:           	pch 	= Get_4_BYTE
0E6A:           	lcall 	Get_4_BYTE
                	;---
0E6B:           	Rm[I1++]	=io[SPI_DAT]   ;12 
0E6C:          	Rm[I1++]	=io[SPI_DAT]   ;13
            	;-------------------
0E6D:       	p1 =  #bit_set_flag  
0E6F:          	ar  =  rm[adp_ch_index]
0E70:          	p1 = p1 + ar
0E71:          	ar  = pm[p1]
0E72:          	bx = rm[AdPcmflag]
0E73:       	ar = ar | bx
0E74:       	rm[AdPcmflag] = ar
               	;------///////---
0E75:          	pop	i1  ;
0E76:          	pop	p1
0E77:          	pop	bx
0E78:          	eni
0E79:       	rets 	
            		
            ;/////////////////////////////////////////////////////////
            SaveToBuff1:
0E7A:       	push p1
0E7B:       	push i0
0E7C:       	ar = rm[adp_ch_index]  ;
0E7D:       	p1 = #adpcm_filt_tab
0E7F:       	p1 = p1  + ar
0E80:       	ar = pm[p1]
0E81:       	i0   = AdpcmFiltBuf
0E83:       	i0  = i0 + ar
0E84:       	rm[i0++]		=ADPPCM		//;0
0E85:       	rm[i0++]		=ADPPCM		//;1
0E86:       	rm[i0++]		=ADPPCM		//;2
0E87:       	rm[i0++]		=ADPPCM		//;3
0E88:       	rm[i0++]		=FLTA			//;4
0E89:       	rm[i0++]		=FLTP			//;5
0E8A:       	i0++			//FLTG			//;6     -----
0E8B:       	rm[i0++]		=ADPHD			//;7
0E8C:       	ar		= rm[read_flag]	       	 ;8 flag
0E8D:       	rm[i0++]		= ar
0E8E:       	ar		= rm[FrameSample1]	        ;9 adpcm data  每个word 4bit 的个数 
0E8F:       	rm[i0++]		= ar
0E90:       	ar 	=	rm[ZeroFrame_s]                 ;10
0E91:       	rm[i0++]=	ar
            	
0E92:       	ar = rm[ADPCM_Data1]
0E93:       	rm[i0++]=	ar				;11
            	
0E94:       	ar = 	rm[adp_spi_adr0]                        ;12
0E95:       	rm[i0++]		= ar
0E96:       	ar = 	rm[adp_spi_adr1]                        ;13
0E97:       	rm[i0++]		= ar
0E98:       	pop	i0
0E99:       	pop 	p1 
0E9A:       	rets
            ;----------------------------------
            RestoreToBuff1:
0E9B:       	push p1
0E9C:       	push	i0
0E9D:       	ar = rm[adp_ch_index]
0E9E:       	p1 = #adpcm_filt_tab
0EA0:       	p1 = p1  + ar
0EA1:       	ar = pm[p1]
0EA2:       	i0   = AdpcmFiltBuf
0EA4:       	i0  = i0 + ar
0EA5:       	ADPPCM		= rm[i0++]		//;0
0EA6:       	ADPPCM		= rm[i0++]		//;1
0EA7:       	ADPPCM		= rm[i0++]		//;2
0EA8:       	ADPPCM		= rm[i0++]		//;3
0EA9:       	FLTA		= rm[i0++]		//;4
0EAA:       	FLTP		= rm[i0++]		//;5
0EAB:       	FLTG		= rm[i0++]		//;6
0EAC:       	ADPHD		= rm[i0++]		//;7
0EAD:       	ar 	        = rm[i0++]               ;8  read_flag
0EAE:       	rm[read_flag]   = ar
0EAF:       	ar 	        = rm[i0++]              ;9  FrameSample1
0EB0:       	rm[FrameSample1]   = ar
0EB1:       	Ar		=FLTO                   
0EB2:       	ar 	        = rm[i0++]          	 ;10  ZeroFrame_s
0EB3:       	rm[ZeroFrame_s] =  ar 
            	
0EB4:       	ar 	        = rm[i0++]          	 ;11  ADPCM_Data1
0EB5:       	rm[ADPCM_Data1] = ar
0EB6:       	ar 	        = rm[i0++]              ;12  adpcm spi adr0
0EB7:       	rm[adp_spi_adr0] = ar 
0EB8:       	ar 	        = rm[i0++] 		;13  adpcm spi adr1
0EB9:       	rm[adp_spi_adr1] = ar 
0EBA:       	pop	i0
0EBB:       	pop  p1
0EBC:        	rets	
            adpcm_filt_tab: ;6ch  adpcm buf
0EBD:       	dw	0,14,28,42,56,70,84;
            ;////////////////////////////////////////////////////
            Adpcm6chPlay:
0EC4:       	ar = 5  ;6ch adpcm
            loop_check_adp_ch:	
0EC5:       	rm[adp_ch_index] = AR 
0EC6:       	p1 =  #bit_set_flag  
0EC8:          	ar  =  rm[adp_ch_index]
0EC9:          	p1 = p1 + ar
0ECA:          	ar  = pm[p1]
0ECB:          	bx = rm[AdPcmflag]
0ECC:       	ar = ar & bx
0ECD:       	jeq	Check_adpcm_next_ch
0ECE:       	pch   = SampelConvert
0ECF:       	lcall	SampelConvert
            Check_adpcm_next_ch:	
0ED0:       	ar = rm[adp_ch_index]
0ED1:       	ar --
0ED2:       	test  ar.b15
0ED3:       	jeq	loop_check_adp_ch
0ED4:       	rets 
            ;//////////////////////////////////////////////////////
            bit_set_flag:
0ED5:       		DW	0x1
0ED6:       		DW	0x2
0ED7:       		DW	0x4
0ED8:       		DW	0x8
0ED9:       		DW	0x10
0EDA:       		DW	0x20
0EDB:       		DW	0x40
0EDC:       		DW	0x80
0EDD:       		DW	0x100
0EDE:       		DW	0x200
0EDF:       		DW	0x400
0EE0:       		DW	0x800
0EE1:       		DW	0x1000
0EE2:       		DW	0x2000
0EE3:       		DW	0x4000
0EE4:       		DW	0x8000
            bit_clr_flag:
0EE5:       		DW	0xfffe
0EE6:       		DW	0xfffd
0EE7:       		DW	0xfffb
0EE8:       		DW	0xfff7
0EE9:       		DW	0xffef
0EEA:       		DW	0xffdf
0EEB:       		DW	0xffbf
0EEC:       		DW	0xff7f
0EED:       		DW	0xfeff
0EEE:       		DW	0xfdff
0EEF:       		DW	0xfbff
0EF0:       		DW	0xf7ff
0EF1:       		DW	0xefff
0EF2:       		DW	0xdfff
0EF3:       		DW	0xbfff
0EF4:       		DW	0x7fff
            ;//////////////////////////////////////////////
            ;=========================Include <E:\Tritan\W633E\160midi+6chadpcm\160midi+6chadpcm\adpcm4.asm> END=========================
            ;DecodeTab:
            ;	DW "OrchestraHit_8K_8000_4-16.PAM"
            ;dw "red_01.PAM"
            
            ;;TRD16IDE V2.32
            _SYSTEM_MAIN_PROGRAM_END_ADDRESS: 
